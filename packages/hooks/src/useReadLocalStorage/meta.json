{
  "$schema": "https://sse-hooks.vercel.app/api/registry/schema/hook.json",
  "name": "use-read-local-storage",
  "type": "registry:hook",
  "title": "useReadLocalStorage",
  "description": "Represents the type for the options available when reading from local storage.",
  "dependencies": [
    "react"
  ],
  "registryDependencies": [
    "use-event-listener"
  ],
  "file": {
    "content": "import { useCallback, useEffect, useState } from \"react\";\n\nimport { useEventListener } from \"./use-event-listener\";\n\nconst IS_SERVER = typeof window === \"undefined\";\n\ntype Options<T, InitializeWithValue extends boolean | undefined> = {\n  deserializer?: (value: string) => T;\n\n  initializeWithValue: InitializeWithValue;\n};\n\nexport function useReadLocalStorage<T>(\n  key: string,\n  options: Options<T, false>,\n): T | null | undefined;\n\nexport function useReadLocalStorage<T>(\n  key: string,\n  options?: Partial<Options<T, true>>,\n): T | null;\n\nexport function useReadLocalStorage<T>(\n  key: string,\n  options: Partial<Options<T, boolean>> = {},\n): T | null | undefined {\n  let { initializeWithValue = true } = options;\n  if (IS_SERVER) {\n    initializeWithValue = false;\n  }\n\n  const deserializer = useCallback<(value: string) => T | null>(\n    (value) => {\n      if (options.deserializer) {\n        return options.deserializer(value);\n      }\n\n      if (value === \"undefined\") {\n        return undefined as unknown as T;\n      }\n\n      let parsed: unknown;\n      try {\n        parsed = JSON.parse(value);\n      } catch (error) {\n        console.error(\"Error parsing JSON:\", error);\n        return null;\n      }\n\n      return parsed as T;\n    },\n    [options],\n  );\n\n  const readValue = useCallback((): T | null => {\n    if (IS_SERVER) {\n      return null;\n    }\n\n    try {\n      const raw = window.localStorage.getItem(key);\n      return raw ? deserializer(raw) : null;\n    } catch (error) {\n      console.warn(`Error reading localStorage key “${key}”:`, error);\n      return null;\n    }\n  }, [key, deserializer]);\n\n  const [storedValue, setStoredValue] = useState(() => {\n    if (initializeWithValue) {\n      return readValue();\n    }\n    return undefined;\n  });\n\n  useEffect(() => {\n    setStoredValue(readValue());\n  }, [key]);\n\n  const handleStorageChange = useCallback(\n    (event: StorageEvent | CustomEvent) => {\n      if ((event as StorageEvent).key && (event as StorageEvent).key !== key) {\n        return;\n      }\n      setStoredValue(readValue());\n    },\n    [key, readValue],\n  );\n\n  useEventListener(\"storage\", handleStorageChange);\n\n  useEventListener(\"local-storage\", handleStorageChange);\n\n  return storedValue;\n}\n",
    "js": "import { useCallback, useEffect, useState } from \"react\";\nimport { useEventListener } from \"./use-event-listener\";\nconst IS_SERVER = typeof window === \"undefined\";\nexport function useReadLocalStorage(key, options = {}) {\n    let { initializeWithValue = true } = options;\n    if (IS_SERVER) {\n        initializeWithValue = false;\n    }\n    const deserializer = useCallback((value) => {\n        if (options.deserializer) {\n            return options.deserializer(value);\n        }\n        if (value === \"undefined\") {\n            return undefined;\n        }\n        let parsed;\n        try {\n            parsed = JSON.parse(value);\n        }\n        catch (error) {\n            console.error(\"Error parsing JSON:\", error);\n            return null;\n        }\n        return parsed;\n    }, [options]);\n    const readValue = useCallback(() => {\n        if (IS_SERVER) {\n            return null;\n        }\n        try {\n            const raw = window.localStorage.getItem(key);\n            return raw ? deserializer(raw) : null;\n        }\n        catch (error) {\n            console.warn(`Error reading localStorage key “${key}”:`, error);\n            return null;\n        }\n    }, [key, deserializer]);\n    const [storedValue, setStoredValue] = useState(() => {\n        if (initializeWithValue) {\n            return readValue();\n        }\n        return undefined;\n    });\n    useEffect(() => {\n        setStoredValue(readValue());\n    }, [key]);\n    const handleStorageChange = useCallback((event) => {\n        if (event.key && event.key !== key) {\n            return;\n        }\n        setStoredValue(readValue());\n    }, [key, readValue]);\n    useEventListener(\"storage\", handleStorageChange);\n    useEventListener(\"local-storage\", handleStorageChange);\n    return storedValue;\n}"
  }
}