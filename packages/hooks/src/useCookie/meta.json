{
  "$schema": "https://raw.githubusercontent.com/sseuniverse/sse-hooks/refs/heads/main/schema/meta.json",
  "name": "use-cookie",
  "type": "registry:hook",
  "title": "useCookie",
  "description": "Options for customizing the behavior of the useCookie hook.",
  "dependencies": [
    "react"
  ],
  "registryDependencies": [
    "use-event-callback",
    "use-event-listener"
  ],
  "file": {
    "content": "import { useCallback, useEffect, useState } from \"react\";\r\nimport type { Dispatch, SetStateAction } from \"react\";\r\n\r\n\n\ndeclare global {\r\n  \r\n  interface WindowEventMap {\r\n    \"cookie-change\": CustomEvent<{ key: string }>;\r\n    visibilitychange: Event;\r\n  }\r\n}\r\n\r\nconst IS_SERVER = typeof document === \"undefined\";\r\n\r\n\r\nexport type UseCookieOptions<T> = {\r\n  \r\n  serializer?: (value: T) => string;\r\n  \r\n  deserializer?: (value: string) => T;\r\n  \r\n  initializeWithValue?: boolean;\r\n\r\n  \r\n  \r\n  prefix?: string;\r\n  \r\n  path?: string;\r\n  \r\n  domain?: string;\r\n  \r\n  expires?: Date;\r\n  \r\n  maxAge?: number;\r\n  \r\n  secure?: boolean;\r\n  \r\n  sameSite?: \"lax\" | \"strict\" | \"none\";\r\n\r\n  \r\n  defaultValue?: T;\r\n};\r\n\r\n\r\nfunction parseCookies(): Record<string, string> {\r\n  if (IS_SERVER) return {};\r\n  return document.cookie.split(\"; \").reduce(\r\n    (acc, part) => {\r\n      const [k, ...v] = part.split(\"=\");\r\n      if (k && v) {\r\n        acc[decodeURIComponent(k.trim())] = decodeURIComponent(v.join(\"=\"));\r\n      }\r\n      return acc;\r\n    },\r\n    {} as Record<string, string>,\r\n  );\r\n}\r\n\r\n\r\nfunction buildCookie(\r\n  key: string,\r\n  value: string,\r\n  options: UseCookieOptions<any>,\r\n) {\r\n  let cookie = `${encodeURIComponent(key)}=${encodeURIComponent(value)}`;\r\n\r\n  if (options.path) cookie += `; path=${options.path}`;\r\n  if (options.domain) cookie += `; domain=${options.domain}`;\r\n  if (options.expires) cookie += `; expires=${options.expires.toUTCString()}`;\r\n  if (options.maxAge) cookie += `; max-age=${options.maxAge}`;\r\n  if (options.secure) cookie += `; secure`;\r\n  if (options.sameSite) cookie += `; samesite=${options.sameSite}`;\r\n\r\n  return cookie;\r\n}\r\n\r\n\r\nexport function useCookie<T>(\r\n  key: string,\r\n  initialValue: T | (() => T),\r\n  options: UseCookieOptions<T> = {},\r\n): [T, Dispatch<SetStateAction<T>>, () => void] {\r\n  const { initializeWithValue = true, prefix = \"\" } = options;\r\n  const cookieKey = prefix + key;\r\n\r\n  const serializer = useCallback<(value: T) => string>(\r\n    (value) => {\r\n      if (options.serializer) return options.serializer(value);\r\n      return JSON.stringify(value);\r\n    },\r\n    [options],\r\n  );\r\n\r\n  const deserializer = useCallback<(value: string) => T>(\r\n    (value) => {\r\n      if (options.deserializer) return options.deserializer(value);\r\n      if (value === \"undefined\") return undefined as unknown as T;\r\n\r\n      const fallback =\r\n        initialValue instanceof Function ? initialValue() : initialValue;\r\n\r\n      try {\r\n        return JSON.parse(value) as T;\r\n      } catch {\r\n        return fallback;\r\n      }\r\n    },\r\n    [options, initialValue],\r\n  );\r\n\r\n  const readValue = useCallback((): T => {\r\n    const fallback =\r\n      initialValue instanceof Function ? initialValue() : initialValue;\r\n\r\n    if (IS_SERVER) return fallback;\r\n\r\n    const cookies = parseCookies();\r\n    if (!(cookieKey in cookies)) return fallback;\r\n\r\n    return deserializer(cookies[cookieKey]);\r\n  }, [cookieKey, deserializer, initialValue]);\r\n\r\n  const [storedValue, setStoredValue] = useState(() => {\r\n    if (initializeWithValue) return readValue();\r\n    return initialValue instanceof Function ? initialValue() : initialValue;\r\n  });\r\n\r\n  const setValue: Dispatch<SetStateAction<T>> = useEventCallback((value) => {\r\n    if (IS_SERVER) return;\r\n\r\n    try {\r\n      const newValue = value instanceof Function ? value(readValue()) : value;\r\n      const serialized = serializer(newValue);\r\n\r\n      document.cookie = buildCookie(cookieKey, serialized, {\r\n        path: \"/\",\r\n        ...options,\r\n      });\r\n\r\n      setStoredValue(newValue);\r\n\r\n      window.dispatchEvent(\r\n        new CustomEvent(\"cookie-change\", { detail: { key: cookieKey } }),\r\n      );\r\n    } catch (error) {\r\n      console.warn(`Error setting cookie \"${cookieKey}\":`, error);\r\n    }\r\n  });\r\n\r\n  const removeValue = useEventCallback(() => {\r\n    if (IS_SERVER) return;\r\n\r\n    const fallback =\r\n      initialValue instanceof Function ? initialValue() : initialValue;\r\n\r\n    document.cookie = buildCookie(cookieKey, \"\", {\r\n      path: \"/\",\r\n      ...options,\r\n      expires: new Date(0),\r\n    });\r\n\r\n    setStoredValue(fallback);\r\n\r\n    window.dispatchEvent(\r\n      new CustomEvent(\"cookie-change\", { detail: { key: cookieKey } }),\r\n    );\r\n  });\r\n\r\n  useEffect(() => {\r\n    setStoredValue(readValue());\r\n    \r\n  }, [cookieKey]);\r\n\r\n  const handleChange = useCallback(\r\n    (event: CustomEvent<{ key: string }> | StorageEvent) => {\r\n      \r\n      if (\"detail\" in event && event.detail?.key !== cookieKey) return;\r\n      if (\"key\" in event && event.key !== cookieKey) return;\r\n\r\n      setStoredValue(readValue());\r\n    },\r\n    [cookieKey, readValue],\r\n  );\r\n\r\n  \r\n  useEventListener(\"cookie-change\", handleChange);\r\n\r\n  \r\n  useEventListener(\"visibilitychange\", () => {\r\n    if (document.visibilityState === \"visible\") {\r\n      setStoredValue(readValue());\r\n    }\r\n  });\r\n\r\n  return [storedValue, setValue, removeValue];\r\n}",
    "js": "import { useCallback, useEffect, useState } from \"react\";\nconst IS_SERVER = typeof document === \"undefined\";\nfunction parseCookies() {\n    if (IS_SERVER)\n        return {};\n    return document.cookie.split(\"; \").reduce((acc, part) => {\n        const [k, ...v] = part.split(\"=\");\n        if (k && v) {\n            acc[decodeURIComponent(k.trim())] = decodeURIComponent(v.join(\"=\"));\n        }\n        return acc;\n    }, {});\n}\nfunction buildCookie(key, value, options) {\n    let cookie = `${encodeURIComponent(key)}=${encodeURIComponent(value)}`;\n    if (options.path)\n        cookie += `; path=${options.path}`;\n    if (options.domain)\n        cookie += `; domain=${options.domain}`;\n    if (options.expires)\n        cookie += `; expires=${options.expires.toUTCString()}`;\n    if (options.maxAge)\n        cookie += `; max-age=${options.maxAge}`;\n    if (options.secure)\n        cookie += `; secure`;\n    if (options.sameSite)\n        cookie += `; samesite=${options.sameSite}`;\n    return cookie;\n}\nexport function useCookie(key, initialValue, options = {}) {\n    const { initializeWithValue = true, prefix = \"\" } = options;\n    const cookieKey = prefix + key;\n    const serializer = useCallback((value) => {\n        if (options.serializer)\n            return options.serializer(value);\n        return JSON.stringify(value);\n    }, [options]);\n    const deserializer = useCallback((value) => {\n        if (options.deserializer)\n            return options.deserializer(value);\n        if (value === \"undefined\")\n            return undefined;\n        const fallback = initialValue instanceof Function ? initialValue() : initialValue;\n        try {\n            return JSON.parse(value);\n        }\n        catch {\n            return fallback;\n        }\n    }, [options, initialValue]);\n    const readValue = useCallback(() => {\n        const fallback = initialValue instanceof Function ? initialValue() : initialValue;\n        if (IS_SERVER)\n            return fallback;\n        const cookies = parseCookies();\n        if (!(cookieKey in cookies))\n            return fallback;\n        return deserializer(cookies[cookieKey]);\n    }, [cookieKey, deserializer, initialValue]);\n    const [storedValue, setStoredValue] = useState(() => {\n        if (initializeWithValue)\n            return readValue();\n        return initialValue instanceof Function ? initialValue() : initialValue;\n    });\n    const setValue = useEventCallback((value) => {\n        if (IS_SERVER)\n            return;\n        try {\n            const newValue = value instanceof Function ? value(readValue()) : value;\n            const serialized = serializer(newValue);\n            document.cookie = buildCookie(cookieKey, serialized, {\n                path: \"/\",\n                ...options,\n            });\n            setStoredValue(newValue);\n            window.dispatchEvent(new CustomEvent(\"cookie-change\", { detail: { key: cookieKey } }));\n        }\n        catch (error) {\n            console.warn(`Error setting cookie \"${cookieKey}\":`, error);\n        }\n    });\n    const removeValue = useEventCallback(() => {\n        if (IS_SERVER)\n            return;\n        const fallback = initialValue instanceof Function ? initialValue() : initialValue;\n        document.cookie = buildCookie(cookieKey, \"\", {\n            path: \"/\",\n            ...options,\n            expires: new Date(0),\n        });\n        setStoredValue(fallback);\n        window.dispatchEvent(new CustomEvent(\"cookie-change\", { detail: { key: cookieKey } }));\n    });\n    useEffect(() => {\n        setStoredValue(readValue());\n    }, [cookieKey]);\n    const handleChange = useCallback((event) => {\n        if (\"detail\" in event && event.detail?.key !== cookieKey)\n            return;\n        if (\"key\" in event && event.key !== cookieKey)\n            return;\n        setStoredValue(readValue());\n    }, [cookieKey, readValue]);\n    useEventListener(\"cookie-change\", handleChange);\n    useEventListener(\"visibilitychange\", () => {\n        if (document.visibilityState === \"visible\") {\n            setStoredValue(readValue());\n        }\n    });\n    return [storedValue, setValue, removeValue];\n}"
  }
}