{
  "$schema": "https://raw.githubusercontent.com/sseuniverse/sse-hooks/refs/heads/main/schema/meta.json",
  "name": "use-cookie",
  "type": "registry:hook",
  "title": "useCookie",
  "description": "Options for customizing the behavior of the useCookie hook.",
  "dependencies": [
    "react"
  ],
  "registryDependencies": [
    "use-event-callback",
    "use-event-listener"
  ],
  "file": {
    "content": "import { useCallback, useEffect, useState } from \"react\";\nimport type { Dispatch, SetStateAction } from \"react\";\n\nimport { useEventCallback } from \"./use-event-callback\";\nimport { useEventListener } from \"./use-event-listener\";\n\ndeclare global {\n  interface WindowEventMap {\n    \"cookie-change\": CustomEvent<{ key: string }>;\n    visibilitychange: Event;\n  }\n}\n\nconst IS_SERVER = typeof document === \"undefined\";\n\nexport type UseCookieOptions<T> = {\n  serializer?: (value: T) => string;\n\n  deserializer?: (value: string) => T;\n\n  initializeWithValue?: boolean;\n\n  prefix?: string;\n\n  path?: string;\n\n  domain?: string;\n\n  expires?: Date;\n\n  maxAge?: number;\n\n  secure?: boolean;\n\n  sameSite?: \"lax\" | \"strict\" | \"none\";\n\n  defaultValue?: T;\n};\n\nfunction parseCookies(): Record<string, string> {\n  if (IS_SERVER) return {};\n  return document.cookie.split(\"; \").reduce(\n    (acc, part) => {\n      const [k, ...v] = part.split(\"=\");\n      if (k && v) {\n        acc[decodeURIComponent(k.trim())] = decodeURIComponent(v.join(\"=\"));\n      }\n      return acc;\n    },\n    {} as Record<string, string>,\n  );\n}\n\nfunction buildCookie(\n  key: string,\n  value: string,\n  options: UseCookieOptions<any>,\n) {\n  let cookie = `${encodeURIComponent(key)}=${encodeURIComponent(value)}`;\n\n  if (options.path) cookie += `; path=${options.path}`;\n  if (options.domain) cookie += `; domain=${options.domain}`;\n  if (options.expires) cookie += `; expires=${options.expires.toUTCString()}`;\n  if (options.maxAge) cookie += `; max-age=${options.maxAge}`;\n  if (options.secure) cookie += `; secure`;\n  if (options.sameSite) cookie += `; samesite=${options.sameSite}`;\n\n  return cookie;\n}\n\nexport function useCookie<T>(\n  key: string,\n  initialValue: T | (() => T),\n  options: UseCookieOptions<T> = {},\n): [T, Dispatch<SetStateAction<T>>, () => void] {\n  const { initializeWithValue = true, prefix = \"\" } = options;\n  const cookieKey = prefix + key;\n\n  const serializer = useCallback<(value: T) => string>(\n    (value) => {\n      if (options.serializer) return options.serializer(value);\n      return JSON.stringify(value);\n    },\n    [options],\n  );\n\n  const deserializer = useCallback<(value: string) => T>(\n    (value) => {\n      if (options.deserializer) return options.deserializer(value);\n      if (value === \"undefined\") return undefined as unknown as T;\n\n      const fallback =\n        initialValue instanceof Function ? initialValue() : initialValue;\n\n      try {\n        return JSON.parse(value) as T;\n      } catch {\n        return fallback;\n      }\n    },\n    [options, initialValue],\n  );\n\n  const readValue = useCallback((): T => {\n    const fallback =\n      initialValue instanceof Function ? initialValue() : initialValue;\n\n    if (IS_SERVER) return fallback;\n\n    const cookies = parseCookies();\n    if (!(cookieKey in cookies)) return fallback;\n\n    return deserializer(cookies[cookieKey]);\n  }, [cookieKey, deserializer, initialValue]);\n\n  const [storedValue, setStoredValue] = useState(() => {\n    if (initializeWithValue) return readValue();\n    return initialValue instanceof Function ? initialValue() : initialValue;\n  });\n\n  const setValue: Dispatch<SetStateAction<T>> = useEventCallback((value) => {\n    if (IS_SERVER) return;\n\n    try {\n      const newValue = value instanceof Function ? value(readValue()) : value;\n      const serialized = serializer(newValue);\n\n      document.cookie = buildCookie(cookieKey, serialized, {\n        path: \"/\",\n        ...options,\n      });\n\n      setStoredValue(newValue);\n\n      window.dispatchEvent(\n        new CustomEvent(\"cookie-change\", { detail: { key: cookieKey } }),\n      );\n    } catch (error) {\n      console.warn(`Error setting cookie \"${cookieKey}\":`, error);\n    }\n  });\n\n  const removeValue = useEventCallback(() => {\n    if (IS_SERVER) return;\n\n    const fallback =\n      initialValue instanceof Function ? initialValue() : initialValue;\n\n    document.cookie = buildCookie(cookieKey, \"\", {\n      path: \"/\",\n      ...options,\n      expires: new Date(0),\n    });\n\n    setStoredValue(fallback);\n\n    window.dispatchEvent(\n      new CustomEvent(\"cookie-change\", { detail: { key: cookieKey } }),\n    );\n  });\n\n  useEffect(() => {\n    setStoredValue(readValue());\n  }, [cookieKey]);\n\n  const handleChange = useCallback(\n    (event: CustomEvent<{ key: string }> | StorageEvent) => {\n      if (\"detail\" in event && event.detail?.key !== cookieKey) return;\n      if (\"key\" in event && event.key !== cookieKey) return;\n\n      setStoredValue(readValue());\n    },\n    [cookieKey, readValue],\n  );\n\n  useEventListener(\"cookie-change\", handleChange);\n\n  useEventListener(\"visibilitychange\", () => {\n    if (document.visibilityState === \"visible\") {\n      setStoredValue(readValue());\n    }\n  });\n\n  return [storedValue, setValue, removeValue];\n}\n",
    "js": "import { useCallback, useEffect, useState } from \"react\";\nimport { useEventCallback } from \"./use-event-callback\";\nimport { useEventListener } from \"./use-event-listener\";\nconst IS_SERVER = typeof document === \"undefined\";\nfunction parseCookies() {\n    if (IS_SERVER)\n        return {};\n    return document.cookie.split(\"; \").reduce((acc, part) => {\n        const [k, ...v] = part.split(\"=\");\n        if (k && v) {\n            acc[decodeURIComponent(k.trim())] = decodeURIComponent(v.join(\"=\"));\n        }\n        return acc;\n    }, {});\n}\nfunction buildCookie(key, value, options) {\n    let cookie = `${encodeURIComponent(key)}=${encodeURIComponent(value)}`;\n    if (options.path)\n        cookie += `; path=${options.path}`;\n    if (options.domain)\n        cookie += `; domain=${options.domain}`;\n    if (options.expires)\n        cookie += `; expires=${options.expires.toUTCString()}`;\n    if (options.maxAge)\n        cookie += `; max-age=${options.maxAge}`;\n    if (options.secure)\n        cookie += `; secure`;\n    if (options.sameSite)\n        cookie += `; samesite=${options.sameSite}`;\n    return cookie;\n}\nexport function useCookie(key, initialValue, options = {}) {\n    const { initializeWithValue = true, prefix = \"\" } = options;\n    const cookieKey = prefix + key;\n    const serializer = useCallback((value) => {\n        if (options.serializer)\n            return options.serializer(value);\n        return JSON.stringify(value);\n    }, [options]);\n    const deserializer = useCallback((value) => {\n        if (options.deserializer)\n            return options.deserializer(value);\n        if (value === \"undefined\")\n            return undefined;\n        const fallback = initialValue instanceof Function ? initialValue() : initialValue;\n        try {\n            return JSON.parse(value);\n        }\n        catch {\n            return fallback;\n        }\n    }, [options, initialValue]);\n    const readValue = useCallback(() => {\n        const fallback = initialValue instanceof Function ? initialValue() : initialValue;\n        if (IS_SERVER)\n            return fallback;\n        const cookies = parseCookies();\n        if (!(cookieKey in cookies))\n            return fallback;\n        return deserializer(cookies[cookieKey]);\n    }, [cookieKey, deserializer, initialValue]);\n    const [storedValue, setStoredValue] = useState(() => {\n        if (initializeWithValue)\n            return readValue();\n        return initialValue instanceof Function ? initialValue() : initialValue;\n    });\n    const setValue = useEventCallback((value) => {\n        if (IS_SERVER)\n            return;\n        try {\n            const newValue = value instanceof Function ? value(readValue()) : value;\n            const serialized = serializer(newValue);\n            document.cookie = buildCookie(cookieKey, serialized, {\n                path: \"/\",\n                ...options,\n            });\n            setStoredValue(newValue);\n            window.dispatchEvent(new CustomEvent(\"cookie-change\", { detail: { key: cookieKey } }));\n        }\n        catch (error) {\n            console.warn(`Error setting cookie \"${cookieKey}\":`, error);\n        }\n    });\n    const removeValue = useEventCallback(() => {\n        if (IS_SERVER)\n            return;\n        const fallback = initialValue instanceof Function ? initialValue() : initialValue;\n        document.cookie = buildCookie(cookieKey, \"\", {\n            path: \"/\",\n            ...options,\n            expires: new Date(0),\n        });\n        setStoredValue(fallback);\n        window.dispatchEvent(new CustomEvent(\"cookie-change\", { detail: { key: cookieKey } }));\n    });\n    useEffect(() => {\n        setStoredValue(readValue());\n    }, [cookieKey]);\n    const handleChange = useCallback((event) => {\n        if (\"detail\" in event && event.detail?.key !== cookieKey)\n            return;\n        if (\"key\" in event && event.key !== cookieKey)\n            return;\n        setStoredValue(readValue());\n    }, [cookieKey, readValue]);\n    useEventListener(\"cookie-change\", handleChange);\n    useEventListener(\"visibilitychange\", () => {\n        if (document.visibilityState === \"visible\") {\n            setStoredValue(readValue());\n        }\n    });\n    return [storedValue, setValue, removeValue];\n}"
  }
}