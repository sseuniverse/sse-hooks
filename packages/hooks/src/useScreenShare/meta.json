{
  "$schema": "https://raw.githubusercontent.com/sseuniverse/sse-hooks/refs/heads/main/schema/meta.json",
  "name": "use-screen-share",
  "type": "registry:hook",
  "title": "useScreenShare",
  "description": "Boolean or specific constraints for the video track.",
  "dependencies": [
    "react"
  ],
  "registryDependencies": [],
  "file": {
    "content": "export interface UseScreenShareOptions {\r\n  \r\n  video?: boolean | MediaTrackConstraints;\r\n  \r\n  audio?: boolean | MediaTrackConstraints;\r\n}\r\n\r\nexport interface UseScreenShareReturn {\r\n  \r\n  stream: MediaStream | null;\r\n  \r\n  error: string | null;\r\n  \r\n  isLoading: boolean;\r\n  \r\n  isSupported: boolean;\r\n  \r\n  startCapture: (constraints?: UseScreenShareOptions) => Promise<void>;\r\n  \r\n  stopCapture: () => void;\r\n}\r\n\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\n\nconst DEFAULT_OPTIONS: UseScreenShareOptions = {\r\n  video: true,\r\n  audio: false,\r\n};\r\n\r\n\r\nexport function useScreenShare(\r\n  initialOptions: UseScreenShareOptions = DEFAULT_OPTIONS,\r\n) {\r\n  const [stream, setStream] = useState<MediaStream | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const streamRef = useRef<MediaStream | null>(null);\r\n\r\n  const isSupported =\r\n    typeof navigator !== \"undefined\" &&\r\n    \"mediaDevices\" in navigator &&\r\n    \"getDisplayMedia\" in navigator.mediaDevices;\r\n\r\n  const stopCapture = useCallback(() => {\r\n    if (streamRef.current) {\r\n      streamRef.current.getTracks().forEach((track) => {\r\n        track.stop();\r\n      });\r\n      streamRef.current = null;\r\n      setStream(null);\r\n    }\r\n    setError(null);\r\n  }, []);\r\n\r\n  const startCapture = useCallback(\r\n    async (options: UseScreenShareOptions = initialOptions) => {\r\n      if (!isSupported) {\r\n        setError(\"getDisplayMedia is not supported in this browser\");\r\n        return;\r\n      }\r\n\r\n      \r\n      stopCapture();\r\n\r\n      setIsLoading(true);\r\n      setError(null);\r\n\r\n      try {\r\n        const mediaStream =\r\n          await navigator.mediaDevices.getDisplayMedia(options);\r\n\r\n        \r\n        const videoTrack = mediaStream.getVideoTracks()[0];\r\n        if (videoTrack) {\r\n          videoTrack.onended = () => {\r\n            stopCapture();\r\n          };\r\n        }\r\n\r\n        streamRef.current = mediaStream;\r\n        setStream(mediaStream);\r\n      } catch (err: any) {\r\n        let errorMessage = \"Failed to start screen sharing\";\r\n\r\n        if (err instanceof Error) {\r\n          switch (err.name) {\r\n            case \"NotAllowedError\":\r\n              errorMessage =\r\n                \"Permission denied or user cancelled the selection.\";\r\n              break;\r\n            case \"NotFoundError\":\r\n              errorMessage = \"No screen video source found.\";\r\n              break;\r\n            case \"NotReadableError\":\r\n              errorMessage =\r\n                \"Could not capture the screen (OS or hardware error).\";\r\n              break;\r\n            case \"OverconstrainedError\":\r\n              errorMessage = \"The specified constraints cannot be satisfied.\";\r\n              break;\r\n            case \"AbortError\":\r\n              errorMessage = \"Screen sharing selection was aborted.\";\r\n              break;\r\n            default:\r\n              errorMessage = err.message || errorMessage;\r\n          }\r\n        }\r\n\r\n        setError(errorMessage);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    },\r\n    [isSupported, initialOptions, stopCapture],\r\n  );\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      stopCapture();\r\n    };\r\n  }, [stopCapture]);\r\n\r\n  return {\r\n    stream,\r\n    error,\r\n    isLoading,\r\n    isSupported,\r\n    startCapture,\r\n    stopCapture,\r\n  };\r\n}",
    "js": "import { useCallback, useEffect, useRef, useState } from \"react\";\nconst DEFAULT_OPTIONS = {\n    video: true,\n    audio: false,\n};\nexport function useScreenShare(initialOptions = DEFAULT_OPTIONS) {\n    const [stream, setStream] = useState(null);\n    const [error, setError] = useState(null);\n    const [isLoading, setIsLoading] = useState(false);\n    const streamRef = useRef(null);\n    const isSupported = typeof navigator !== \"undefined\" &&\n        \"mediaDevices\" in navigator &&\n        \"getDisplayMedia\" in navigator.mediaDevices;\n    const stopCapture = useCallback(() => {\n        if (streamRef.current) {\n            streamRef.current.getTracks().forEach((track) => {\n                track.stop();\n            });\n            streamRef.current = null;\n            setStream(null);\n        }\n        setError(null);\n    }, []);\n    const startCapture = useCallback(async (options = initialOptions) => {\n        if (!isSupported) {\n            setError(\"getDisplayMedia is not supported in this browser\");\n            return;\n        }\n        stopCapture();\n        setIsLoading(true);\n        setError(null);\n        try {\n            const mediaStream = await navigator.mediaDevices.getDisplayMedia(options);\n            const videoTrack = mediaStream.getVideoTracks()[0];\n            if (videoTrack) {\n                videoTrack.onended = () => {\n                    stopCapture();\n                };\n            }\n            streamRef.current = mediaStream;\n            setStream(mediaStream);\n        }\n        catch (err) {\n            let errorMessage = \"Failed to start screen sharing\";\n            if (err instanceof Error) {\n                switch (err.name) {\n                    case \"NotAllowedError\":\n                        errorMessage =\n                            \"Permission denied or user cancelled the selection.\";\n                        break;\n                    case \"NotFoundError\":\n                        errorMessage = \"No screen video source found.\";\n                        break;\n                    case \"NotReadableError\":\n                        errorMessage =\n                            \"Could not capture the screen (OS or hardware error).\";\n                        break;\n                    case \"OverconstrainedError\":\n                        errorMessage = \"The specified constraints cannot be satisfied.\";\n                        break;\n                    case \"AbortError\":\n                        errorMessage = \"Screen sharing selection was aborted.\";\n                        break;\n                    default:\n                        errorMessage = err.message || errorMessage;\n                }\n            }\n            setError(errorMessage);\n        }\n        finally {\n            setIsLoading(false);\n        }\n    }, [isSupported, initialOptions, stopCapture]);\n    useEffect(() => {\n        return () => {\n            stopCapture();\n        };\n    }, [stopCapture]);\n    return {\n        stream,\n        error,\n        isLoading,\n        isSupported,\n        startCapture,\n        stopCapture,\n    };\n}"
  }
}