{
  "$schema": "https://sse-hooks.vercel.app/api/registry/schema/hook.json",
  "name": "use-screen-share",
  "type": "registry:hook",
  "title": "useScreenShare",
  "description": "Boolean or specific constraints for the video track.",
  "dependencies": [
    "react"
  ],
  "registryDependencies": [],
  "file": {
    "content": "export interface UseScreenShareOptions {\n  video?: boolean | MediaTrackConstraints;\n\n  audio?: boolean | MediaTrackConstraints;\n}\n\nexport interface UseScreenShareReturn {\n  stream: MediaStream | null;\n\n  error: string | null;\n\n  isLoading: boolean;\n\n  isSupported: boolean;\n\n  startCapture: (constraints?: UseScreenShareOptions) => Promise<void>;\n\n  stopCapture: () => void;\n}\n\nimport { useCallback, useEffect, useRef, useState } from \"react\";\n\nconst DEFAULT_OPTIONS: UseScreenShareOptions = {\n  video: true,\n  audio: false,\n};\n\nexport function useScreenShare(\n  initialOptions: UseScreenShareOptions = DEFAULT_OPTIONS,\n) {\n  const [stream, setStream] = useState<MediaStream | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const streamRef = useRef<MediaStream | null>(null);\n\n  const isSupported =\n    typeof navigator !== \"undefined\" &&\n    \"mediaDevices\" in navigator &&\n    \"getDisplayMedia\" in navigator.mediaDevices;\n\n  const stopCapture = useCallback(() => {\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach((track) => {\n        track.stop();\n      });\n      streamRef.current = null;\n      setStream(null);\n    }\n    setError(null);\n  }, []);\n\n  const startCapture = useCallback(\n    async (options: UseScreenShareOptions = initialOptions) => {\n      if (!isSupported) {\n        setError(\"getDisplayMedia is not supported in this browser\");\n        return;\n      }\n\n      stopCapture();\n\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const mediaStream =\n          await navigator.mediaDevices.getDisplayMedia(options);\n\n        const videoTrack = mediaStream.getVideoTracks()[0];\n        if (videoTrack) {\n          videoTrack.onended = () => {\n            stopCapture();\n          };\n        }\n\n        streamRef.current = mediaStream;\n        setStream(mediaStream);\n      } catch (err: any) {\n        let errorMessage = \"Failed to start screen sharing\";\n\n        if (err instanceof Error) {\n          switch (err.name) {\n            case \"NotAllowedError\":\n              errorMessage =\n                \"Permission denied or user cancelled the selection.\";\n              break;\n            case \"NotFoundError\":\n              errorMessage = \"No screen video source found.\";\n              break;\n            case \"NotReadableError\":\n              errorMessage =\n                \"Could not capture the screen (OS or hardware error).\";\n              break;\n            case \"OverconstrainedError\":\n              errorMessage = \"The specified constraints cannot be satisfied.\";\n              break;\n            case \"AbortError\":\n              errorMessage = \"Screen sharing selection was aborted.\";\n              break;\n            default:\n              errorMessage = err.message || errorMessage;\n          }\n        }\n\n        setError(errorMessage);\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [isSupported, initialOptions, stopCapture],\n  );\n\n  useEffect(() => {\n    return () => {\n      stopCapture();\n    };\n  }, [stopCapture]);\n\n  return {\n    stream,\n    error,\n    isLoading,\n    isSupported,\n    startCapture,\n    stopCapture,\n  };\n}\n",
    "js": "import { useCallback, useEffect, useRef, useState } from \"react\";\nconst DEFAULT_OPTIONS = {\n    video: true,\n    audio: false,\n};\nexport function useScreenShare(initialOptions = DEFAULT_OPTIONS) {\n    const [stream, setStream] = useState(null);\n    const [error, setError] = useState(null);\n    const [isLoading, setIsLoading] = useState(false);\n    const streamRef = useRef(null);\n    const isSupported = typeof navigator !== \"undefined\" &&\n        \"mediaDevices\" in navigator &&\n        \"getDisplayMedia\" in navigator.mediaDevices;\n    const stopCapture = useCallback(() => {\n        if (streamRef.current) {\n            streamRef.current.getTracks().forEach((track) => {\n                track.stop();\n            });\n            streamRef.current = null;\n            setStream(null);\n        }\n        setError(null);\n    }, []);\n    const startCapture = useCallback(async (options = initialOptions) => {\n        if (!isSupported) {\n            setError(\"getDisplayMedia is not supported in this browser\");\n            return;\n        }\n        stopCapture();\n        setIsLoading(true);\n        setError(null);\n        try {\n            const mediaStream = await navigator.mediaDevices.getDisplayMedia(options);\n            const videoTrack = mediaStream.getVideoTracks()[0];\n            if (videoTrack) {\n                videoTrack.onended = () => {\n                    stopCapture();\n                };\n            }\n            streamRef.current = mediaStream;\n            setStream(mediaStream);\n        }\n        catch (err) {\n            let errorMessage = \"Failed to start screen sharing\";\n            if (err instanceof Error) {\n                switch (err.name) {\n                    case \"NotAllowedError\":\n                        errorMessage =\n                            \"Permission denied or user cancelled the selection.\";\n                        break;\n                    case \"NotFoundError\":\n                        errorMessage = \"No screen video source found.\";\n                        break;\n                    case \"NotReadableError\":\n                        errorMessage =\n                            \"Could not capture the screen (OS or hardware error).\";\n                        break;\n                    case \"OverconstrainedError\":\n                        errorMessage = \"The specified constraints cannot be satisfied.\";\n                        break;\n                    case \"AbortError\":\n                        errorMessage = \"Screen sharing selection was aborted.\";\n                        break;\n                    default:\n                        errorMessage = err.message || errorMessage;\n                }\n            }\n            setError(errorMessage);\n        }\n        finally {\n            setIsLoading(false);\n        }\n    }, [isSupported, initialOptions, stopCapture]);\n    useEffect(() => {\n        return () => {\n            stopCapture();\n        };\n    }, [stopCapture]);\n    return {\n        stream,\n        error,\n        isLoading,\n        isSupported,\n        startCapture,\n        stopCapture,\n    };\n}"
  }
}