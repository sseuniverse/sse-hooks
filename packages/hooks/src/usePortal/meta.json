{
  "$schema": "https://raw.githubusercontent.com/sseuniverse/sse-hooks/refs/heads/main/schema/meta.json",
  "name": "use-portal",
  "type": "registry:hook",
  "title": "usePortal",
  "description": "A safe, typed alternative to findDOMNode. * Works with: 1. DOM Elements (returns them directly) 2. Ref Objects (returns .current) 3. Null/Undefined (returns null) * NOT SUPPORTED: Passing a Class Component instance directly (legacy behavior). You must use a Ref for Components.",
  "dependencies": [
    "react",
    "react-dom"
  ],
  "registryDependencies": [
    "use-ssr"
  ],
  "file": {
    "content": "import React from \"react\";\r\n\r\nconst ELEMENT_NODE = 1;\r\nconst TEXT_NODE = 3;\r\n\r\ntype ComponentOrElement<T> =\r\n  | Element\r\n  | Text\r\n  | React.Component\r\n  | React.RefObject<T>\r\n  | null\r\n  | undefined;\r\n\r\n\r\nexport default function findDOMNode<T = Element | Text>(\r\n  componentOrElement: ComponentOrElement<T>,\r\n): T | null {\r\n  if (componentOrElement === null) {\r\n    return null;\r\n  }\r\n\r\n  if (componentOrElement && \"nodeType\" in componentOrElement) {\r\n    const node = componentOrElement as Node;\r\n    if (node.nodeType === ELEMENT_NODE || node.nodeType === TEXT_NODE) {\r\n      return node as unknown as T;\r\n    }\r\n  }\r\n\r\n  if (\r\n    componentOrElement &&\r\n    \"current\" in componentOrElement &&\r\n    componentOrElement.current !== null\r\n  ) {\r\n    return (componentOrElement as React.RefObject<T>).current;\r\n  }\r\n\r\n  if (process.env.NODE_ENV !== \"production\") {\r\n    console.warn(\r\n      \"[findDOMNode] You passed a Component instance or an unknown object. \" +\r\n        \"This utility cannot strictly find DOM nodes from Component instances (like the deprecated react-dom version could). \" +\r\n        \"Please pass a Ref (ref.current) or a direct DOM element.\",\r\n    );\r\n  }\r\n\r\n  return null;\r\n}\r\n\nimport React from \"react\";\r\n\r\nexport type HTMLElRef = React.MutableRefObject<HTMLElement>;\r\nexport type CustomEvent = {\r\n  event?: React.SyntheticEvent<any, Event>;\r\n  portal: HTMLElRef;\r\n  targetEl: HTMLElRef;\r\n} & React.SyntheticEvent<any, Event>;\r\n\r\nexport type CustomEventHandler = (customEvent: CustomEvent) => void;\r\nexport type CustomEventHandlers = {\r\n  [K in keyof React.DOMAttributes<K>]?: CustomEventHandler;\r\n};\r\n\r\nexport type EventListenerMap = {\r\n  [K in keyof React.DOMAttributes<K>]: keyof GlobalEventHandlersEventMap;\r\n};\r\n\r\nexport type EventListenersRef = React.MutableRefObject<{\r\n  [K in keyof React.DOMAttributes<K>]?: (\r\n    event: React.SyntheticEvent<any, Event>,\r\n  ) => void;\r\n}>;\r\n\r\nexport type UsePortalOptions = {\r\n  closeOnOutsideClick?: boolean;\r\n  closeOnEsc?: boolean;\r\n  bindTo?: HTMLElement; \r\n  isOpen?: boolean;\r\n  onOpen?: CustomEventHandler;\r\n  onClose?: CustomEventHandler;\r\n  onPortalClick?: CustomEventHandler;\r\n  programmaticallyOpen?: boolean;\r\n} & CustomEventHandlers;\r\n\r\nexport type UsePortalObjectReturn = {};\r\nexport type UsePortalArrayReturn = [];\r\n\nimport React, {\r\n  ReactNode,\r\n  useCallback,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\n\n\n\nexport const errorMessage1 =\r\n  \"You must either add a `ref` to the element you are interacting with or pass an `event` to openPortal(e) or togglePortal(e) when the `programmaticallyOpen` option is not set to `true`.\";\r\n\r\nexport default function usePortal({\r\n  closeOnOutsideClick = true,\r\n  closeOnEsc = true,\r\n  bindTo, \r\n  isOpen: defaultIsOpen = false,\r\n  onOpen,\r\n  onClose,\r\n  onPortalClick,\r\n  programmaticallyOpen = false,\r\n  ...eventHandlers\r\n}: UsePortalOptions = {}) {\r\n  const { isServer, isBrowser } = useSSR();\r\n  const [isOpen, makeOpen] = useState(defaultIsOpen);\r\n  const open = useRef(isOpen);\r\n\r\n  const setOpen = useCallback((v: boolean) => {\r\n    open.current = v;\r\n    makeOpen(v);\r\n  }, []);\r\n\r\n  \r\n  const targetEl = useRef() as HTMLElRef;\r\n  const portal = useRef(\r\n    isBrowser ? document.createElement(\"div\") : null,\r\n  ) as HTMLElRef;\r\n\r\n  useEffect(() => {\r\n    if (isBrowser && !portal.current) {\r\n      portal.current = document.createElement(\"div\");\r\n    }\r\n  }, [isBrowser, portal]);\r\n\r\n  const elToMountTo = useMemo(() => {\r\n    if (isServer) return;\r\n    return (bindTo && findDOMNode(bindTo)) || document.body;\r\n  }, [isServer, bindTo]);\r\n\r\n  const createCustomEvent = (e: any) => {\r\n    if (!e) return { portal, targetEl, event: e };\r\n    const event = e || {};\r\n    if (event.persist) event.persist();\r\n    event.portal = portal;\r\n    event.targetEl = targetEl;\r\n    event.event = e;\r\n    const { currentTarget } = e;\r\n    if (!targetEl.current && currentTarget && currentTarget !== document) {\r\n      targetEl.current = event.currentTarget;\r\n    }\r\n    return event;\r\n  };\r\n\r\n  \r\n  const customEventHandlers: CustomEventHandlers = Object.entries(\r\n    eventHandlers,\r\n  ).reduce<any>((acc, [handlerName, eventHandler]) => {\r\n    acc[handlerName] = (event?: React.SyntheticEvent<any, Event>) => {\r\n      if (isServer) return;\r\n      eventHandler(createCustomEvent(event));\r\n    };\r\n    return acc;\r\n  }, {});\r\n\r\n  const openPortal = useCallback(\r\n    (e: any) => {\r\n      if (isServer) return;\r\n      const customEvent = createCustomEvent(e);\r\n      \r\n      \r\n      \r\n      if (targetEl.current == null && !programmaticallyOpen) {\r\n        setTimeout(() => setOpen(true), 0);\r\n        throw Error(errorMessage1);\r\n      }\r\n      if (onOpen) onOpen(customEvent);\r\n      setOpen(true);\r\n    },\r\n    [isServer, portal, setOpen, targetEl, onOpen],\r\n  );\r\n\r\n  const closePortal = useCallback(\r\n    (e: any) => {\r\n      if (isServer) return;\r\n      const customEvent = createCustomEvent(e);\r\n      if (onClose && open.current) onClose(customEvent);\r\n      if (open.current) setOpen(false);\r\n    },\r\n    [isServer, onClose, setOpen],\r\n  );\r\n\r\n  const togglePortal = useCallback(\r\n    (e: React.SyntheticEvent<any, Event>): void =>\r\n      open.current ? closePortal(e) : openPortal(e),\r\n    [closePortal, openPortal],\r\n  );\r\n\r\n  const handleKeydown = useCallback(\r\n    (e: KeyboardEvent): void =>\r\n      e.key === \"Escape\" && closeOnEsc ? closePortal(e) : undefined,\r\n    [closeOnEsc, closePortal],\r\n  );\r\n\r\n  const handleOutsideMouseClick = useCallback(\r\n    (e: MouseEvent): void => {\r\n      const containsTarget = (target: HTMLElRef) =>\r\n        target.current.contains(e.target as HTMLElement);\r\n      \r\n      if (\r\n        containsTarget(portal) ||\r\n        (e as any).button !== 0 ||\r\n        !open.current ||\r\n        (targetEl.current && containsTarget(targetEl))\r\n      )\r\n        return;\r\n\r\n      if (closeOnOutsideClick) closePortal(e);\r\n    },\r\n    [isServer, closePortal, closeOnOutsideClick, portal],\r\n  );\r\n\r\n  const handleMouseDown = useCallback(\r\n    (e: MouseEvent): void => {\r\n      if (isServer || !(portal.current instanceof HTMLElement)) return;\r\n      const customEvent = createCustomEvent(e);\r\n      if (\r\n        portal.current.contains(customEvent.target as HTMLElement) &&\r\n        onPortalClick\r\n      )\r\n        onPortalClick(customEvent);\r\n      handleOutsideMouseClick(e);\r\n    },\r\n    [handleOutsideMouseClick],\r\n  );\r\n\r\n  const eventListeners = useRef({}) as EventListenersRef;\r\n\r\n  useEffect(() => {\r\n    if (isServer) return;\r\n    if (\r\n      !(elToMountTo instanceof HTMLElement) ||\r\n      !(portal.current instanceof HTMLElement)\r\n    )\r\n      return;\r\n\r\n    \r\n    \r\n    \r\n    const eventHandlerMap: EventListenerMap = {\r\n      onScroll: \"scroll\",\r\n      onWheel: \"wheel\",\r\n    };\r\n    const node = portal.current;\r\n    elToMountTo.appendChild(portal.current);\r\n    \r\n    Object.entries(eventHandlerMap).forEach(\r\n      ([handlerName , eventListenerName ]) => {\r\n        if (!eventHandlers[handlerName as keyof EventListenerMap]) return;\r\n        eventListeners.current[handlerName as keyof EventListenerMap] = (\r\n          e: any,\r\n        ) =>\r\n          (eventHandlers[handlerName as keyof EventListenerMap] as any)(\r\n            createCustomEvent(e),\r\n          );\r\n        document.addEventListener(\r\n          eventListenerName as keyof GlobalEventHandlersEventMap,\r\n          eventListeners.current[handlerName as keyof EventListenerMap] as any,\r\n        );\r\n      },\r\n    );\r\n    document.addEventListener(\"keydown\", handleKeydown);\r\n    document.addEventListener(\"mousedown\", handleMouseDown as any);\r\n\r\n    return () => {\r\n      \r\n      Object.entries(eventHandlerMap).forEach(\r\n        ([handlerName, eventListenerName]) => {\r\n          if (!eventHandlers[handlerName as keyof EventListenerMap]) return;\r\n          document.removeEventListener(\r\n            eventListenerName as keyof GlobalEventHandlersEventMap,\r\n            eventListeners.current[\r\n              handlerName as keyof EventListenerMap\r\n            ] as any,\r\n          );\r\n          delete eventListeners.current[handlerName as keyof EventListenerMap];\r\n        },\r\n      );\r\n      document.removeEventListener(\"keydown\", handleKeydown);\r\n      document.removeEventListener(\"mousedown\", handleMouseDown as any);\r\n      elToMountTo.removeChild(node);\r\n    };\r\n  }, [isServer, handleOutsideMouseClick, handleKeydown, elToMountTo, portal]);\r\n\r\n  const Portal = useCallback(\r\n    ({ children }: { children: ReactNode }) => {\r\n      if (portal.current != null) return createPortal(children, portal.current);\r\n      return null;\r\n    },\r\n    [portal],\r\n  );\r\n\r\n  return Object.assign(\r\n    [\r\n      openPortal,\r\n      closePortal,\r\n      open.current,\r\n      Portal,\r\n      togglePortal,\r\n      targetEl,\r\n      portal,\r\n    ],\r\n    {\r\n      isOpen: open.current,\r\n      openPortal,\r\n      ref: targetEl,\r\n      closePortal,\r\n      togglePortal,\r\n      Portal,\r\n      portalRef: portal,\r\n      ...customEventHandlers,\r\n      bind: {\r\n        \r\n        ref: targetEl,\r\n        ...customEventHandlers,\r\n      },\r\n    },\r\n  );\r\n}",
    "js": "const ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\nexport default function findDOMNode(componentOrElement) {\n    if (componentOrElement === null) {\n        return null;\n    }\n    if (componentOrElement && \"nodeType\" in componentOrElement) {\n        const node = componentOrElement;\n        if (node.nodeType === ELEMENT_NODE || node.nodeType === TEXT_NODE) {\n            return node;\n        }\n    }\n    if (componentOrElement &&\n        \"current\" in componentOrElement &&\n        componentOrElement.current !== null) {\n        return componentOrElement.current;\n    }\n    if (process.env.NODE_ENV !== \"production\") {\n        console.warn(\"[findDOMNode] You passed a Component instance or an unknown object. \" +\n            \"This utility cannot strictly find DOM nodes from Component instances (like the deprecated react-dom version could). \" +\n            \"Please pass a Ref (ref.current) or a direct DOM element.\");\n    }\n    return null;\n}\nimport { useCallback, useEffect, useMemo, useRef, useState, } from \"react\";\nimport { createPortal } from \"react-dom\";\nexport const errorMessage1 = \"You must either add a `ref` to the element you are interacting with or pass an `event` to openPortal(e) or togglePortal(e) when the `programmaticallyOpen` option is not set to `true`.\";\nexport default function usePortal({ closeOnOutsideClick = true, closeOnEsc = true, bindTo, isOpen: defaultIsOpen = false, onOpen, onClose, onPortalClick, programmaticallyOpen = false, ...eventHandlers } = {}) {\n    const { isServer, isBrowser } = useSSR();\n    const [isOpen, makeOpen] = useState(defaultIsOpen);\n    const open = useRef(isOpen);\n    const setOpen = useCallback((v) => {\n        open.current = v;\n        makeOpen(v);\n    }, []);\n    const targetEl = useRef();\n    const portal = useRef(isBrowser ? document.createElement(\"div\") : null);\n    useEffect(() => {\n        if (isBrowser && !portal.current) {\n            portal.current = document.createElement(\"div\");\n        }\n    }, [isBrowser, portal]);\n    const elToMountTo = useMemo(() => {\n        if (isServer)\n            return;\n        return (bindTo && findDOMNode(bindTo)) || document.body;\n    }, [isServer, bindTo]);\n    const createCustomEvent = (e) => {\n        if (!e)\n            return { portal, targetEl, event: e };\n        const event = e || {};\n        if (event.persist)\n            event.persist();\n        event.portal = portal;\n        event.targetEl = targetEl;\n        event.event = e;\n        const { currentTarget } = e;\n        if (!targetEl.current && currentTarget && currentTarget !== document) {\n            targetEl.current = event.currentTarget;\n        }\n        return event;\n    };\n    const customEventHandlers = Object.entries(eventHandlers).reduce((acc, [handlerName, eventHandler]) => {\n        acc[handlerName] = (event) => {\n            if (isServer)\n                return;\n            eventHandler(createCustomEvent(event));\n        };\n        return acc;\n    }, {});\n    const openPortal = useCallback((e) => {\n        if (isServer)\n            return;\n        const customEvent = createCustomEvent(e);\n        if (targetEl.current == null && !programmaticallyOpen) {\n            setTimeout(() => setOpen(true), 0);\n            throw Error(errorMessage1);\n        }\n        if (onOpen)\n            onOpen(customEvent);\n        setOpen(true);\n    }, [isServer, portal, setOpen, targetEl, onOpen]);\n    const closePortal = useCallback((e) => {\n        if (isServer)\n            return;\n        const customEvent = createCustomEvent(e);\n        if (onClose && open.current)\n            onClose(customEvent);\n        if (open.current)\n            setOpen(false);\n    }, [isServer, onClose, setOpen]);\n    const togglePortal = useCallback((e) => open.current ? closePortal(e) : openPortal(e), [closePortal, openPortal]);\n    const handleKeydown = useCallback((e) => e.key === \"Escape\" && closeOnEsc ? closePortal(e) : undefined, [closeOnEsc, closePortal]);\n    const handleOutsideMouseClick = useCallback((e) => {\n        const containsTarget = (target) => target.current.contains(e.target);\n        if (containsTarget(portal) ||\n            e.button !== 0 ||\n            !open.current ||\n            (targetEl.current && containsTarget(targetEl)))\n            return;\n        if (closeOnOutsideClick)\n            closePortal(e);\n    }, [isServer, closePortal, closeOnOutsideClick, portal]);\n    const handleMouseDown = useCallback((e) => {\n        if (isServer || !(portal.current instanceof HTMLElement))\n            return;\n        const customEvent = createCustomEvent(e);\n        if (portal.current.contains(customEvent.target) &&\n            onPortalClick)\n            onPortalClick(customEvent);\n        handleOutsideMouseClick(e);\n    }, [handleOutsideMouseClick]);\n    const eventListeners = useRef({});\n    useEffect(() => {\n        if (isServer)\n            return;\n        if (!(elToMountTo instanceof HTMLElement) ||\n            !(portal.current instanceof HTMLElement))\n            return;\n        const eventHandlerMap = {\n            onScroll: \"scroll\",\n            onWheel: \"wheel\",\n        };\n        const node = portal.current;\n        elToMountTo.appendChild(portal.current);\n        Object.entries(eventHandlerMap).forEach(([handlerName, eventListenerName]) => {\n            if (!eventHandlers[handlerName])\n                return;\n            eventListeners.current[handlerName] = (e) => eventHandlers[handlerName](createCustomEvent(e));\n            document.addEventListener(eventListenerName, eventListeners.current[handlerName]);\n        });\n        document.addEventListener(\"keydown\", handleKeydown);\n        document.addEventListener(\"mousedown\", handleMouseDown);\n        return () => {\n            Object.entries(eventHandlerMap).forEach(([handlerName, eventListenerName]) => {\n                if (!eventHandlers[handlerName])\n                    return;\n                document.removeEventListener(eventListenerName, eventListeners.current[handlerName]);\n                delete eventListeners.current[handlerName];\n            });\n            document.removeEventListener(\"keydown\", handleKeydown);\n            document.removeEventListener(\"mousedown\", handleMouseDown);\n            elToMountTo.removeChild(node);\n        };\n    }, [isServer, handleOutsideMouseClick, handleKeydown, elToMountTo, portal]);\n    const Portal = useCallback(({ children }) => {\n        if (portal.current != null)\n            return createPortal(children, portal.current);\n        return null;\n    }, [portal]);\n    return Object.assign([\n        openPortal,\n        closePortal,\n        open.current,\n        Portal,\n        togglePortal,\n        targetEl,\n        portal,\n    ], {\n        isOpen: open.current,\n        openPortal,\n        ref: targetEl,\n        closePortal,\n        togglePortal,\n        Portal,\n        portalRef: portal,\n        ...customEventHandlers,\n        bind: {\n            ref: targetEl,\n            ...customEventHandlers,\n        },\n    });\n}"
  }
}