{
  "$schema": "https://raw.githubusercontent.com/sseuniverse/sse-hooks/refs/heads/main/schema/meta.json",
  "name": "use-portal",
  "type": "registry:hook",
  "title": "usePortal",
  "description": "A safe, typed alternative to findDOMNode. Works with: 1. DOM Elements (returns them directly) 2. Ref Objects (returns .current) 3. Null/Undefined (returns null) NOT SUPPORTED: Passing a Class Component instance directly (legacy behavior). You must use a Ref for Components.",
  "dependencies": [
    "react",
    "react-dom"
  ],
  "registryDependencies": [
    "use-ssr"
  ],
  "file": {
    "content": "import React from \"react\";\n\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\n\ntype ComponentOrElement<T> =\n  | Element\n  | Text\n  | React.Component\n  | React.RefObject<T>\n  | null\n  | undefined;\n\nexport default function findDOMNode<T = Element | Text>(\n  componentOrElement: ComponentOrElement<T>,\n): T | null {\n  if (componentOrElement === null) {\n    return null;\n  }\n\n  if (componentOrElement && \"nodeType\" in componentOrElement) {\n    const node = componentOrElement as Node;\n    if (node.nodeType === ELEMENT_NODE || node.nodeType === TEXT_NODE) {\n      return node as unknown as T;\n    }\n  }\n\n  if (\n    componentOrElement &&\n    \"current\" in componentOrElement &&\n    componentOrElement.current !== null\n  ) {\n    return (componentOrElement as React.RefObject<T>).current;\n  }\n\n  if (process.env.NODE_ENV !== \"production\") {\n    console.warn(\n      \"[findDOMNode] You passed a Component instance or an unknown object. \" +\n        \"This utility cannot strictly find DOM nodes from Component instances (like the deprecated react-dom version could). \" +\n        \"Please pass a Ref (ref.current) or a direct DOM element.\",\n    );\n  }\n\n  return null;\n}\n\nimport React from \"react\";\n\nexport type HTMLElRef = React.MutableRefObject<HTMLElement>;\nexport type CustomEvent = {\n  event?: React.SyntheticEvent<any, Event>;\n  portal: HTMLElRef;\n  targetEl: HTMLElRef;\n} & React.SyntheticEvent<any, Event>;\n\nexport type CustomEventHandler = (customEvent: CustomEvent) => void;\nexport type CustomEventHandlers = {\n  [K in keyof React.DOMAttributes<K>]?: CustomEventHandler;\n};\n\nexport type EventListenerMap = {\n  [K in keyof React.DOMAttributes<K>]: keyof GlobalEventHandlersEventMap;\n};\n\nexport type EventListenersRef = React.MutableRefObject<{\n  [K in keyof React.DOMAttributes<K>]?: (\n    event: React.SyntheticEvent<any, Event>,\n  ) => void;\n}>;\n\nexport type UsePortalOptions = {\n  closeOnOutsideClick?: boolean;\n\n  closeOnEsc?: boolean;\n\n  bindTo?: HTMLElement;\n\n  isOpen?: boolean;\n\n  onOpen?: CustomEventHandler;\n\n  onClose?: CustomEventHandler;\n\n  onPortalClick?: CustomEventHandler;\n\n  programmaticallyOpen?: boolean;\n} & CustomEventHandlers;\n\nexport type UsePortalObjectReturn = {};\nexport type UsePortalArrayReturn = [];\n\nimport React, {\n  ReactNode,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { useSSR } from \"./use-ssr\";\n\nexport const errorMessage1 =\n  \"You must either add a `ref` to the element you are interacting with or pass an `event` to openPortal(e) or togglePortal(e) when the `programmaticallyOpen` option is not set to `true`.\";\n\nexport default function usePortal({\n  closeOnOutsideClick = true,\n  closeOnEsc = true,\n  bindTo,\n  isOpen: defaultIsOpen = false,\n  onOpen,\n  onClose,\n  onPortalClick,\n  programmaticallyOpen = false,\n  ...eventHandlers\n}: UsePortalOptions = {}) {\n  const { isServer, isBrowser } = useSSR();\n  const [isOpen, makeOpen] = useState(defaultIsOpen);\n  const open = useRef(isOpen);\n\n  const setOpen = useCallback((v: boolean) => {\n    open.current = v;\n    makeOpen(v);\n  }, []);\n\n  const targetEl = useRef() as HTMLElRef;\n  const portal = useRef(\n    isBrowser ? document.createElement(\"div\") : null,\n  ) as HTMLElRef;\n\n  useEffect(() => {\n    if (isBrowser && !portal.current) {\n      portal.current = document.createElement(\"div\");\n    }\n  }, [isBrowser, portal]);\n\n  const elToMountTo = useMemo(() => {\n    if (isServer) return;\n    return (bindTo && findDOMNode(bindTo)) || document.body;\n  }, [isServer, bindTo]);\n\n  const createCustomEvent = (e: any) => {\n    if (!e) return { portal, targetEl, event: e };\n    const event = e || {};\n    if (event.persist) event.persist();\n    event.portal = portal;\n    event.targetEl = targetEl;\n    event.event = e;\n    const { currentTarget } = e;\n    if (!targetEl.current && currentTarget && currentTarget !== document) {\n      targetEl.current = event.currentTarget;\n    }\n    return event;\n  };\n\n  const customEventHandlers: CustomEventHandlers = Object.entries(\n    eventHandlers,\n  ).reduce<any>((acc, [handlerName, eventHandler]) => {\n    acc[handlerName] = (event?: React.SyntheticEvent<any, Event>) => {\n      if (isServer) return;\n      eventHandler(createCustomEvent(event));\n    };\n    return acc;\n  }, {});\n\n  const openPortal = useCallback(\n    (e: any) => {\n      if (isServer) return;\n      const customEvent = createCustomEvent(e);\n\n      if (targetEl.current == null && !programmaticallyOpen) {\n        setTimeout(() => setOpen(true), 0);\n        throw Error(errorMessage1);\n      }\n      if (onOpen) onOpen(customEvent);\n      setOpen(true);\n    },\n    [isServer, portal, setOpen, targetEl, onOpen],\n  );\n\n  const closePortal = useCallback(\n    (e: any) => {\n      if (isServer) return;\n      const customEvent = createCustomEvent(e);\n      if (onClose && open.current) onClose(customEvent);\n      if (open.current) setOpen(false);\n    },\n    [isServer, onClose, setOpen],\n  );\n\n  const togglePortal = useCallback(\n    (e: React.SyntheticEvent<any, Event>): void =>\n      open.current ? closePortal(e) : openPortal(e),\n    [closePortal, openPortal],\n  );\n\n  const handleKeydown = useCallback(\n    (e: KeyboardEvent): void =>\n      e.key === \"Escape\" && closeOnEsc ? closePortal(e) : undefined,\n    [closeOnEsc, closePortal],\n  );\n\n  const handleOutsideMouseClick = useCallback(\n    (e: MouseEvent): void => {\n      const containsTarget = (target: HTMLElRef) =>\n        target.current.contains(e.target as HTMLElement);\n\n      if (\n        containsTarget(portal) ||\n        (e as any).button !== 0 ||\n        !open.current ||\n        (targetEl.current && containsTarget(targetEl))\n      )\n        return;\n\n      if (closeOnOutsideClick) closePortal(e);\n    },\n    [isServer, closePortal, closeOnOutsideClick, portal],\n  );\n\n  const handleMouseDown = useCallback(\n    (e: MouseEvent): void => {\n      if (isServer || !(portal.current instanceof HTMLElement)) return;\n      const customEvent = createCustomEvent(e);\n      if (\n        portal.current.contains(customEvent.target as HTMLElement) &&\n        onPortalClick\n      )\n        onPortalClick(customEvent);\n      handleOutsideMouseClick(e);\n    },\n    [handleOutsideMouseClick],\n  );\n\n  const eventListeners = useRef({}) as EventListenersRef;\n\n  useEffect(() => {\n    if (isServer) return;\n    if (\n      !(elToMountTo instanceof HTMLElement) ||\n      !(portal.current instanceof HTMLElement)\n    )\n      return;\n\n    const eventHandlerMap: EventListenerMap = {\n      onScroll: \"scroll\",\n      onWheel: \"wheel\",\n    };\n    const node = portal.current;\n    elToMountTo.appendChild(portal.current);\n\n    Object.entries(eventHandlerMap).forEach(\n      ([handlerName, eventListenerName]) => {\n        if (!eventHandlers[handlerName as keyof EventListenerMap]) return;\n        eventListeners.current[handlerName as keyof EventListenerMap] = (\n          e: any,\n        ) =>\n          (eventHandlers[handlerName as keyof EventListenerMap] as any)(\n            createCustomEvent(e),\n          );\n        document.addEventListener(\n          eventListenerName as keyof GlobalEventHandlersEventMap,\n          eventListeners.current[handlerName as keyof EventListenerMap] as any,\n        );\n      },\n    );\n    document.addEventListener(\"keydown\", handleKeydown);\n    document.addEventListener(\"mousedown\", handleMouseDown as any);\n\n    return () => {\n      Object.entries(eventHandlerMap).forEach(\n        ([handlerName, eventListenerName]) => {\n          if (!eventHandlers[handlerName as keyof EventListenerMap]) return;\n          document.removeEventListener(\n            eventListenerName as keyof GlobalEventHandlersEventMap,\n            eventListeners.current[\n              handlerName as keyof EventListenerMap\n            ] as any,\n          );\n          delete eventListeners.current[handlerName as keyof EventListenerMap];\n        },\n      );\n      document.removeEventListener(\"keydown\", handleKeydown);\n      document.removeEventListener(\"mousedown\", handleMouseDown as any);\n      elToMountTo.removeChild(node);\n    };\n  }, [isServer, handleOutsideMouseClick, handleKeydown, elToMountTo, portal]);\n\n  const Portal = useCallback(\n    ({ children }: { children: ReactNode }) => {\n      if (portal.current != null) return createPortal(children, portal.current);\n      return null;\n    },\n    [portal],\n  );\n\n  return Object.assign(\n    [\n      openPortal,\n      closePortal,\n      open.current,\n      Portal,\n      togglePortal,\n      targetEl,\n      portal,\n    ],\n    {\n      isOpen: open.current,\n      openPortal,\n      ref: targetEl,\n      closePortal,\n      togglePortal,\n      Portal,\n      portalRef: portal,\n      ...customEventHandlers,\n      bind: {\n        ref: targetEl,\n        ...customEventHandlers,\n      },\n    },\n  );\n}\n",
    "js": "const ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\nexport default function findDOMNode(componentOrElement) {\n    if (componentOrElement === null) {\n        return null;\n    }\n    if (componentOrElement && \"nodeType\" in componentOrElement) {\n        const node = componentOrElement;\n        if (node.nodeType === ELEMENT_NODE || node.nodeType === TEXT_NODE) {\n            return node;\n        }\n    }\n    if (componentOrElement &&\n        \"current\" in componentOrElement &&\n        componentOrElement.current !== null) {\n        return componentOrElement.current;\n    }\n    if (process.env.NODE_ENV !== \"production\") {\n        console.warn(\"[findDOMNode] You passed a Component instance or an unknown object. \" +\n            \"This utility cannot strictly find DOM nodes from Component instances (like the deprecated react-dom version could). \" +\n            \"Please pass a Ref (ref.current) or a direct DOM element.\");\n    }\n    return null;\n}\nimport { useCallback, useEffect, useMemo, useRef, useState, } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { useSSR } from \"./use-ssr\";\nexport const errorMessage1 = \"You must either add a `ref` to the element you are interacting with or pass an `event` to openPortal(e) or togglePortal(e) when the `programmaticallyOpen` option is not set to `true`.\";\nexport default function usePortal({ closeOnOutsideClick = true, closeOnEsc = true, bindTo, isOpen: defaultIsOpen = false, onOpen, onClose, onPortalClick, programmaticallyOpen = false, ...eventHandlers } = {}) {\n    const { isServer, isBrowser } = useSSR();\n    const [isOpen, makeOpen] = useState(defaultIsOpen);\n    const open = useRef(isOpen);\n    const setOpen = useCallback((v) => {\n        open.current = v;\n        makeOpen(v);\n    }, []);\n    const targetEl = useRef();\n    const portal = useRef(isBrowser ? document.createElement(\"div\") : null);\n    useEffect(() => {\n        if (isBrowser && !portal.current) {\n            portal.current = document.createElement(\"div\");\n        }\n    }, [isBrowser, portal]);\n    const elToMountTo = useMemo(() => {\n        if (isServer)\n            return;\n        return (bindTo && findDOMNode(bindTo)) || document.body;\n    }, [isServer, bindTo]);\n    const createCustomEvent = (e) => {\n        if (!e)\n            return { portal, targetEl, event: e };\n        const event = e || {};\n        if (event.persist)\n            event.persist();\n        event.portal = portal;\n        event.targetEl = targetEl;\n        event.event = e;\n        const { currentTarget } = e;\n        if (!targetEl.current && currentTarget && currentTarget !== document) {\n            targetEl.current = event.currentTarget;\n        }\n        return event;\n    };\n    const customEventHandlers = Object.entries(eventHandlers).reduce((acc, [handlerName, eventHandler]) => {\n        acc[handlerName] = (event) => {\n            if (isServer)\n                return;\n            eventHandler(createCustomEvent(event));\n        };\n        return acc;\n    }, {});\n    const openPortal = useCallback((e) => {\n        if (isServer)\n            return;\n        const customEvent = createCustomEvent(e);\n        if (targetEl.current == null && !programmaticallyOpen) {\n            setTimeout(() => setOpen(true), 0);\n            throw Error(errorMessage1);\n        }\n        if (onOpen)\n            onOpen(customEvent);\n        setOpen(true);\n    }, [isServer, portal, setOpen, targetEl, onOpen]);\n    const closePortal = useCallback((e) => {\n        if (isServer)\n            return;\n        const customEvent = createCustomEvent(e);\n        if (onClose && open.current)\n            onClose(customEvent);\n        if (open.current)\n            setOpen(false);\n    }, [isServer, onClose, setOpen]);\n    const togglePortal = useCallback((e) => open.current ? closePortal(e) : openPortal(e), [closePortal, openPortal]);\n    const handleKeydown = useCallback((e) => e.key === \"Escape\" && closeOnEsc ? closePortal(e) : undefined, [closeOnEsc, closePortal]);\n    const handleOutsideMouseClick = useCallback((e) => {\n        const containsTarget = (target) => target.current.contains(e.target);\n        if (containsTarget(portal) ||\n            e.button !== 0 ||\n            !open.current ||\n            (targetEl.current && containsTarget(targetEl)))\n            return;\n        if (closeOnOutsideClick)\n            closePortal(e);\n    }, [isServer, closePortal, closeOnOutsideClick, portal]);\n    const handleMouseDown = useCallback((e) => {\n        if (isServer || !(portal.current instanceof HTMLElement))\n            return;\n        const customEvent = createCustomEvent(e);\n        if (portal.current.contains(customEvent.target) &&\n            onPortalClick)\n            onPortalClick(customEvent);\n        handleOutsideMouseClick(e);\n    }, [handleOutsideMouseClick]);\n    const eventListeners = useRef({});\n    useEffect(() => {\n        if (isServer)\n            return;\n        if (!(elToMountTo instanceof HTMLElement) ||\n            !(portal.current instanceof HTMLElement))\n            return;\n        const eventHandlerMap = {\n            onScroll: \"scroll\",\n            onWheel: \"wheel\",\n        };\n        const node = portal.current;\n        elToMountTo.appendChild(portal.current);\n        Object.entries(eventHandlerMap).forEach(([handlerName, eventListenerName]) => {\n            if (!eventHandlers[handlerName])\n                return;\n            eventListeners.current[handlerName] = (e) => eventHandlers[handlerName](createCustomEvent(e));\n            document.addEventListener(eventListenerName, eventListeners.current[handlerName]);\n        });\n        document.addEventListener(\"keydown\", handleKeydown);\n        document.addEventListener(\"mousedown\", handleMouseDown);\n        return () => {\n            Object.entries(eventHandlerMap).forEach(([handlerName, eventListenerName]) => {\n                if (!eventHandlers[handlerName])\n                    return;\n                document.removeEventListener(eventListenerName, eventListeners.current[handlerName]);\n                delete eventListeners.current[handlerName];\n            });\n            document.removeEventListener(\"keydown\", handleKeydown);\n            document.removeEventListener(\"mousedown\", handleMouseDown);\n            elToMountTo.removeChild(node);\n        };\n    }, [isServer, handleOutsideMouseClick, handleKeydown, elToMountTo, portal]);\n    const Portal = useCallback(({ children }) => {\n        if (portal.current != null)\n            return createPortal(children, portal.current);\n        return null;\n    }, [portal]);\n    return Object.assign([\n        openPortal,\n        closePortal,\n        open.current,\n        Portal,\n        togglePortal,\n        targetEl,\n        portal,\n    ], {\n        isOpen: open.current,\n        openPortal,\n        ref: targetEl,\n        closePortal,\n        togglePortal,\n        Portal,\n        portalRef: portal,\n        ...customEventHandlers,\n        bind: {\n            ref: targetEl,\n            ...customEventHandlers,\n        },\n    });\n}"
  }
}