{
  "$schema": "https://raw.githubusercontent.com/sseuniverse/sse-hooks/refs/heads/main/schema/meta.json",
  "name": "use-role-guard",
  "type": "registry:hook",
  "title": "useRoleGuard",
  "description": "",
  "dependencies": [
    "react"
  ],
  "registryDependencies": [],
  "file": {
    "content": "export interface User {\r\n  id: string;\r\n  roles: string[];\r\n  [key: string]: any;\r\n}\r\n\r\nexport interface UseRoleGuardOptions {\r\n  user?: User | null;\r\n  redirectTo?: string;\r\n  fallbackComponent?: React.ComponentType;\r\n  onUnauthorized?: () => void;\r\n  sessionKey?: string;\r\n}\r\n\r\nexport interface UseRoleGuardReturn {\r\n  hasAccess: boolean;\r\n  hasAnyRole: (roles: string[]) => boolean;\r\n  hasAllRoles: (roles: string[]) => boolean;\r\n  isLoading: boolean;\r\n  user: User | null;\r\n  checkAccess: (requiredRoles: string[]) => boolean;\r\n  redirect: () => void;\r\n}\r\n\nimport { useCallback, useEffect, useState } from \"react\";\r\n\nexport function useRoleGuard(\r\n  requiredRoles: string[],\r\n  options: UseRoleGuardOptions = {},\r\n): UseRoleGuardReturn {\r\n  const {\r\n    user: providedUser,\r\n    redirectTo = \"/unauthorized\",\r\n    onUnauthorized,\r\n    sessionKey = \"user\",\r\n  } = options;\r\n\r\n  const [user, setUser] = useState<User | null>(providedUser || null);\r\n  const [isLoading, setIsLoading] = useState(!providedUser);\r\n\r\n  useEffect(() => {\r\n    if (!providedUser && typeof window !== \"undefined\") {\r\n      try {\r\n        const sessionUser = sessionStorage.getItem(sessionKey);\r\n        if (sessionUser) {\r\n          const parsedUser = JSON.parse(sessionUser);\r\n          setUser(parsedUser);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error parsing user from session:\", error);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    }\r\n  }, [providedUser, sessionKey]);\r\n\r\n  const hasAnyRole = useCallback(\r\n    (roles: string[]): boolean => {\r\n      if (!user || !user.roles) return false;\r\n      return roles.some((role) => user.roles.includes(role));\r\n    },\r\n    [user],\r\n  );\r\n\r\n  const hasAllRoles = useCallback(\r\n    (roles: string[]): boolean => {\r\n      if (!user || !user.roles) return false;\r\n      return roles.every((role) => user.roles.includes(role));\r\n    },\r\n    [user],\r\n  );\r\n\r\n  const checkAccess = useCallback(\r\n    (roles: string[]): boolean => {\r\n      return hasAnyRole(roles);\r\n    },\r\n    [hasAnyRole],\r\n  );\r\n\r\n  const hasAccess = checkAccess(requiredRoles);\r\n\r\n  const redirect = useCallback(() => {\r\n    if (typeof window !== \"undefined\" && redirectTo) {\r\n      window.location.href = redirectTo;\r\n    }\r\n  }, [redirectTo]);\r\n\r\n  useEffect(() => {\r\n    if (!isLoading && !hasAccess) {\r\n      if (onUnauthorized) {\r\n        onUnauthorized();\r\n      } else if (redirectTo && typeof window !== \"undefined\") {\r\n        redirect();\r\n      }\r\n    }\r\n  }, [hasAccess, isLoading, onUnauthorized, redirect, redirectTo]);\r\n\r\n  return {\r\n    hasAccess,\r\n    hasAnyRole,\r\n    hasAllRoles,\r\n    isLoading,\r\n    user,\r\n    checkAccess,\r\n    redirect,\r\n  };\r\n}",
    "js": "import { useCallback, useEffect, useState } from \"react\";\nexport function useRoleGuard(requiredRoles, options = {}) {\n    const { user: providedUser, redirectTo = \"/unauthorized\", onUnauthorized, sessionKey = \"user\", } = options;\n    const [user, setUser] = useState(providedUser || null);\n    const [isLoading, setIsLoading] = useState(!providedUser);\n    useEffect(() => {\n        if (!providedUser && typeof window !== \"undefined\") {\n            try {\n                const sessionUser = sessionStorage.getItem(sessionKey);\n                if (sessionUser) {\n                    const parsedUser = JSON.parse(sessionUser);\n                    setUser(parsedUser);\n                }\n            }\n            catch (error) {\n                console.error(\"Error parsing user from session:\", error);\n            }\n            finally {\n                setIsLoading(false);\n            }\n        }\n    }, [providedUser, sessionKey]);\n    const hasAnyRole = useCallback((roles) => {\n        if (!user || !user.roles)\n            return false;\n        return roles.some((role) => user.roles.includes(role));\n    }, [user]);\n    const hasAllRoles = useCallback((roles) => {\n        if (!user || !user.roles)\n            return false;\n        return roles.every((role) => user.roles.includes(role));\n    }, [user]);\n    const checkAccess = useCallback((roles) => {\n        return hasAnyRole(roles);\n    }, [hasAnyRole]);\n    const hasAccess = checkAccess(requiredRoles);\n    const redirect = useCallback(() => {\n        if (typeof window !== \"undefined\" && redirectTo) {\n            window.location.href = redirectTo;\n        }\n    }, [redirectTo]);\n    useEffect(() => {\n        if (!isLoading && !hasAccess) {\n            if (onUnauthorized) {\n                onUnauthorized();\n            }\n            else if (redirectTo && typeof window !== \"undefined\") {\n                redirect();\n            }\n        }\n    }, [hasAccess, isLoading, onUnauthorized, redirect, redirectTo]);\n    return {\n        hasAccess,\n        hasAnyRole,\n        hasAllRoles,\n        isLoading,\n        user,\n        checkAccess,\n        redirect,\n    };\n}"
  }
}