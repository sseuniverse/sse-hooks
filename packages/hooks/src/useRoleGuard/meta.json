{
  "$schema": "https://raw.githubusercontent.com/sseuniverse/sse-hooks/refs/heads/main/schema/meta.json",
  "name": "use-role-guard",
  "type": "registry:hook",
  "title": "useRoleGuard",
  "description": "The user object. If not provided, attempts to read from session storage.",
  "dependencies": [
    "react"
  ],
  "registryDependencies": [],
  "file": {
    "content": "export interface User {\n  id: string;\n  roles: string[];\n  [key: string]: any;\n}\n\nexport interface UseRoleGuardOptions {\n  user?: User | null;\n\n  redirectTo?: string;\n\n  fallbackComponent?: React.ComponentType;\n\n  onUnauthorized?: () => void;\n\n  sessionKey?: string;\n}\n\nexport interface UseRoleGuardReturn {\n  hasAccess: boolean;\n\n  hasAnyRole: (roles: string[]) => boolean;\n\n  hasAllRoles: (roles: string[]) => boolean;\n\n  isLoading: boolean;\n\n  user: User | null;\n\n  checkAccess: (requiredRoles: string[]) => boolean;\n\n  redirect: () => void;\n}\n\nimport { useCallback, useEffect, useState } from \"react\";\n\nexport function useRoleGuard(\n  requiredRoles: string[],\n  options: UseRoleGuardOptions = {},\n): UseRoleGuardReturn {\n  const {\n    user: providedUser,\n    redirectTo = \"/unauthorized\",\n    onUnauthorized,\n    sessionKey = \"user\",\n  } = options;\n\n  const [user, setUser] = useState<User | null>(providedUser || null);\n  const [isLoading, setIsLoading] = useState(!providedUser);\n\n  useEffect(() => {\n    if (!providedUser && typeof window !== \"undefined\") {\n      try {\n        const sessionUser = sessionStorage.getItem(sessionKey);\n        if (sessionUser) {\n          const parsedUser = JSON.parse(sessionUser);\n          setUser(parsedUser);\n        }\n      } catch (error) {\n        console.error(\"Error parsing user from session:\", error);\n      } finally {\n        setIsLoading(false);\n      }\n    }\n  }, [providedUser, sessionKey]);\n\n  const hasAnyRole = useCallback(\n    (roles: string[]): boolean => {\n      if (!user || !user.roles) return false;\n      return roles.some((role) => user.roles.includes(role));\n    },\n    [user],\n  );\n\n  const hasAllRoles = useCallback(\n    (roles: string[]): boolean => {\n      if (!user || !user.roles) return false;\n      return roles.every((role) => user.roles.includes(role));\n    },\n    [user],\n  );\n\n  const checkAccess = useCallback(\n    (roles: string[]): boolean => {\n      return hasAnyRole(roles);\n    },\n    [hasAnyRole],\n  );\n\n  const hasAccess = checkAccess(requiredRoles);\n\n  const redirect = useCallback(() => {\n    if (typeof window !== \"undefined\" && redirectTo) {\n      window.location.href = redirectTo;\n    }\n  }, [redirectTo]);\n\n  useEffect(() => {\n    if (!isLoading && !hasAccess) {\n      if (onUnauthorized) {\n        onUnauthorized();\n      } else if (redirectTo && typeof window !== \"undefined\") {\n        redirect();\n      }\n    }\n  }, [hasAccess, isLoading, onUnauthorized, redirect, redirectTo]);\n\n  return {\n    hasAccess,\n    hasAnyRole,\n    hasAllRoles,\n    isLoading,\n    user,\n    checkAccess,\n    redirect,\n  };\n}\n",
    "js": "import { useCallback, useEffect, useState } from \"react\";\nexport function useRoleGuard(requiredRoles, options = {}) {\n    const { user: providedUser, redirectTo = \"/unauthorized\", onUnauthorized, sessionKey = \"user\", } = options;\n    const [user, setUser] = useState(providedUser || null);\n    const [isLoading, setIsLoading] = useState(!providedUser);\n    useEffect(() => {\n        if (!providedUser && typeof window !== \"undefined\") {\n            try {\n                const sessionUser = sessionStorage.getItem(sessionKey);\n                if (sessionUser) {\n                    const parsedUser = JSON.parse(sessionUser);\n                    setUser(parsedUser);\n                }\n            }\n            catch (error) {\n                console.error(\"Error parsing user from session:\", error);\n            }\n            finally {\n                setIsLoading(false);\n            }\n        }\n    }, [providedUser, sessionKey]);\n    const hasAnyRole = useCallback((roles) => {\n        if (!user || !user.roles)\n            return false;\n        return roles.some((role) => user.roles.includes(role));\n    }, [user]);\n    const hasAllRoles = useCallback((roles) => {\n        if (!user || !user.roles)\n            return false;\n        return roles.every((role) => user.roles.includes(role));\n    }, [user]);\n    const checkAccess = useCallback((roles) => {\n        return hasAnyRole(roles);\n    }, [hasAnyRole]);\n    const hasAccess = checkAccess(requiredRoles);\n    const redirect = useCallback(() => {\n        if (typeof window !== \"undefined\" && redirectTo) {\n            window.location.href = redirectTo;\n        }\n    }, [redirectTo]);\n    useEffect(() => {\n        if (!isLoading && !hasAccess) {\n            if (onUnauthorized) {\n                onUnauthorized();\n            }\n            else if (redirectTo && typeof window !== \"undefined\") {\n                redirect();\n            }\n        }\n    }, [hasAccess, isLoading, onUnauthorized, redirect, redirectTo]);\n    return {\n        hasAccess,\n        hasAnyRole,\n        hasAllRoles,\n        isLoading,\n        user,\n        checkAccess,\n        redirect,\n    };\n}"
  }
}