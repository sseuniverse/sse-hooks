{
  "$schema": "https://raw.githubusercontent.com/sseuniverse/sse-hooks/refs/heads/main/schema/meta.json",
  "name": "use-session-storage",
  "type": "registry:hook",
  "title": "useSessionStorage",
  "description": "Represents the options for customizing the behavior of serialization and deserialization.",
  "dependencies": [
    "react"
  ],
  "registryDependencies": [
    "use-event-callback",
    "use-event-listener"
  ],
  "file": {
    "content": "import { useCallback, useEffect, useState } from \"react\";\r\n\r\nimport type { Dispatch, SetStateAction } from \"react\";\r\n\r\n\n\ndeclare global {\r\n  \r\n  interface WindowEventMap {\r\n    \"session-storage\": CustomEvent;\r\n  }\r\n}\r\n\r\n\r\ntype UseSessionStorageOptions<T> = {\r\n  \r\n  serializer?: (value: T) => string;\r\n  \r\n  deserializer?: (value: string) => T;\r\n  \r\n  initializeWithValue?: boolean;\r\n};\r\n\r\nconst IS_SERVER = typeof window === \"undefined\";\r\n\r\n\r\nexport function useSessionStorage<T>(\r\n  key: string,\r\n  initialValue: T | (() => T),\r\n  options: UseSessionStorageOptions<T> = {},\r\n): [T, Dispatch<SetStateAction<T>>, () => void] {\r\n  const { initializeWithValue = true } = options;\r\n\r\n  const serializer = useCallback<(value: T) => string>(\r\n    (value) => {\r\n      if (options.serializer) {\r\n        return options.serializer(value);\r\n      }\r\n\r\n      return JSON.stringify(value);\r\n    },\r\n    [options],\r\n  );\r\n\r\n  const deserializer = useCallback<(value: string) => T>(\r\n    (value) => {\r\n      if (options.deserializer) {\r\n        return options.deserializer(value);\r\n      }\r\n      \r\n      if (value === \"undefined\") {\r\n        return undefined as unknown as T;\r\n      }\r\n\r\n      const defaultValue =\r\n        initialValue instanceof Function ? initialValue() : initialValue;\r\n\r\n      let parsed: unknown;\r\n      try {\r\n        parsed = JSON.parse(value);\r\n      } catch (error) {\r\n        console.error(\"Error parsing JSON:\", error);\r\n        return defaultValue; \r\n      }\r\n\r\n      return parsed as T;\r\n    },\r\n    [options, initialValue],\r\n  );\r\n\r\n  \r\n  \r\n  const readValue = useCallback((): T => {\r\n    const initialValueToUse =\r\n      initialValue instanceof Function ? initialValue() : initialValue;\r\n\r\n    \r\n    if (IS_SERVER) {\r\n      return initialValueToUse;\r\n    }\r\n\r\n    try {\r\n      const raw = window.sessionStorage.getItem(key);\r\n      return raw ? deserializer(raw) : initialValueToUse;\r\n    } catch (error) {\r\n      console.warn(`Error reading sessionStorage key “${key}”:`, error);\r\n      return initialValueToUse;\r\n    }\r\n  }, [initialValue, key, deserializer]);\r\n\r\n  const [storedValue, setStoredValue] = useState(() => {\r\n    if (initializeWithValue) {\r\n      return readValue();\r\n    }\r\n\r\n    return initialValue instanceof Function ? initialValue() : initialValue;\r\n  });\r\n\r\n  \r\n  \r\n  const setValue: Dispatch<SetStateAction<T>> = useEventCallback((value) => {\r\n    \r\n    if (IS_SERVER) {\r\n      console.warn(\r\n        `Tried setting sessionStorage key “${key}” even though environment is not a client`,\r\n      );\r\n    }\r\n\r\n    try {\r\n      \r\n      const newValue = value instanceof Function ? value(readValue()) : value;\r\n\r\n      \r\n      window.sessionStorage.setItem(key, serializer(newValue));\r\n\r\n      \r\n      setStoredValue(newValue);\r\n\r\n      \r\n      window.dispatchEvent(new StorageEvent(\"session-storage\", { key }));\r\n    } catch (error) {\r\n      console.warn(`Error setting sessionStorage key “${key}”:`, error);\r\n    }\r\n  });\r\n\r\n  const removeValue = useEventCallback(() => {\r\n    \r\n    if (IS_SERVER) {\r\n      console.warn(\r\n        `Tried removing sessionStorage key “${key}” even though environment is not a client`,\r\n      );\r\n    }\r\n\r\n    const defaultValue =\r\n      initialValue instanceof Function ? initialValue() : initialValue;\r\n\r\n    \r\n    window.sessionStorage.removeItem(key);\r\n\r\n    \r\n    setStoredValue(defaultValue);\r\n\r\n    \r\n    window.dispatchEvent(new StorageEvent(\"session-storage\", { key }));\r\n  });\r\n\r\n  useEffect(() => {\r\n    setStoredValue(readValue());\r\n    \r\n  }, [key]);\r\n\r\n  const handleStorageChange = useCallback(\r\n    (event: StorageEvent | CustomEvent) => {\r\n      if ((event as StorageEvent).key && (event as StorageEvent).key !== key) {\r\n        return;\r\n      }\r\n      setStoredValue(readValue());\r\n    },\r\n    [key, readValue],\r\n  );\r\n\r\n  \r\n  useEventListener(\"storage\", handleStorageChange);\r\n\r\n  \r\n  \r\n  useEventListener(\"session-storage\", handleStorageChange);\r\n\r\n  return [storedValue, setValue, removeValue];\r\n}",
    "js": "import { useCallback, useEffect, useState } from \"react\";\nconst IS_SERVER = typeof window === \"undefined\";\nexport function useSessionStorage(key, initialValue, options = {}) {\n    const { initializeWithValue = true } = options;\n    const serializer = useCallback((value) => {\n        if (options.serializer) {\n            return options.serializer(value);\n        }\n        return JSON.stringify(value);\n    }, [options]);\n    const deserializer = useCallback((value) => {\n        if (options.deserializer) {\n            return options.deserializer(value);\n        }\n        if (value === \"undefined\") {\n            return undefined;\n        }\n        const defaultValue = initialValue instanceof Function ? initialValue() : initialValue;\n        let parsed;\n        try {\n            parsed = JSON.parse(value);\n        }\n        catch (error) {\n            console.error(\"Error parsing JSON:\", error);\n            return defaultValue;\n        }\n        return parsed;\n    }, [options, initialValue]);\n    const readValue = useCallback(() => {\n        const initialValueToUse = initialValue instanceof Function ? initialValue() : initialValue;\n        if (IS_SERVER) {\n            return initialValueToUse;\n        }\n        try {\n            const raw = window.sessionStorage.getItem(key);\n            return raw ? deserializer(raw) : initialValueToUse;\n        }\n        catch (error) {\n            console.warn(`Error reading sessionStorage key “${key}”:`, error);\n            return initialValueToUse;\n        }\n    }, [initialValue, key, deserializer]);\n    const [storedValue, setStoredValue] = useState(() => {\n        if (initializeWithValue) {\n            return readValue();\n        }\n        return initialValue instanceof Function ? initialValue() : initialValue;\n    });\n    const setValue = useEventCallback((value) => {\n        if (IS_SERVER) {\n            console.warn(`Tried setting sessionStorage key “${key}” even though environment is not a client`);\n        }\n        try {\n            const newValue = value instanceof Function ? value(readValue()) : value;\n            window.sessionStorage.setItem(key, serializer(newValue));\n            setStoredValue(newValue);\n            window.dispatchEvent(new StorageEvent(\"session-storage\", { key }));\n        }\n        catch (error) {\n            console.warn(`Error setting sessionStorage key “${key}”:`, error);\n        }\n    });\n    const removeValue = useEventCallback(() => {\n        if (IS_SERVER) {\n            console.warn(`Tried removing sessionStorage key “${key}” even though environment is not a client`);\n        }\n        const defaultValue = initialValue instanceof Function ? initialValue() : initialValue;\n        window.sessionStorage.removeItem(key);\n        setStoredValue(defaultValue);\n        window.dispatchEvent(new StorageEvent(\"session-storage\", { key }));\n    });\n    useEffect(() => {\n        setStoredValue(readValue());\n    }, [key]);\n    const handleStorageChange = useCallback((event) => {\n        if (event.key && event.key !== key) {\n            return;\n        }\n        setStoredValue(readValue());\n    }, [key, readValue]);\n    useEventListener(\"storage\", handleStorageChange);\n    useEventListener(\"session-storage\", handleStorageChange);\n    return [storedValue, setValue, removeValue];\n}"
  }
}