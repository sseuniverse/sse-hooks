{
  "$schema": "https://raw.githubusercontent.com/sseuniverse/sse-hooks/refs/heads/main/schema/meta.json",
  "name": "use-user-media",
  "type": "registry:hook",
  "title": "useUserMedia",
  "description": "Constraints for the `useUserMedia` hook. Defines the video and audio settings for the media stream.",
  "dependencies": [
    "react"
  ],
  "registryDependencies": [],
  "file": {
    "content": "export interface UseUserMediaConstraints {\r\n  \r\n  video?: boolean | MediaTrackConstraints;\r\n  \r\n  audio?: boolean | MediaTrackConstraints;\r\n}\r\n\r\n\r\nexport interface UseUserMediaReturn {\r\n  \r\n  stream: MediaStream | null;\r\n  \r\n  error: string | null;\r\n  \r\n  isLoading: boolean;\r\n  \r\n  isSupported: boolean;\r\n  \r\n  startCapture: (constraints?: UseUserMediaConstraints) => Promise<void>;\r\n  \r\n  stopCapture: () => void;\r\n}\r\n\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\n\nconst DEFAULT_CONSTRAINTS: UseUserMediaConstraints = {\r\n  video: true,\r\n  audio: true,\r\n};\r\n\r\n\r\nexport const useUserMedia = (\r\n  initialConstraints: UseUserMediaConstraints = DEFAULT_CONSTRAINTS,\r\n): UseUserMediaReturn => {\r\n  const [stream, setStream] = useState<MediaStream | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const streamRef = useRef<MediaStream | null>(null);\r\n\r\n  const isSupported =\r\n    typeof navigator !== \"undefined\" &&\r\n    \"mediaDevices\" in navigator &&\r\n    \"getUserMedia\" in navigator.mediaDevices;\r\n\r\n  const stopCapture = useCallback(() => {\r\n    if (streamRef.current) {\r\n      streamRef.current.getTracks().forEach((track) => {\r\n        track.stop();\r\n      });\r\n      streamRef.current = null;\r\n      setStream(null);\r\n    }\r\n    setError(null);\r\n  }, []);\r\n\r\n  const startCapture = useCallback(\r\n    async (constraints: UseUserMediaConstraints = initialConstraints) => {\r\n      if (!isSupported) {\r\n        setError(\"getUserMedia is not supported in this browser\");\r\n        return;\r\n      }\r\n\r\n      \r\n      stopCapture();\r\n\r\n      setIsLoading(true);\r\n      setError(null);\r\n\r\n      try {\r\n        const mediaStream =\r\n          await navigator.mediaDevices.getUserMedia(constraints);\r\n        streamRef.current = mediaStream;\r\n        setStream(mediaStream);\r\n      } catch (err: any) {\r\n        let errorMessage = \"Failed to access media devices\";\r\n\r\n        if (err instanceof Error) {\r\n          switch (err.name) {\r\n            case \"NotAllowedError\":\r\n              errorMessage =\r\n                \"Permission denied. Please allow camera/microphone access.\";\r\n              break;\r\n            case \"NotFoundError\":\r\n              errorMessage = \"No camera or microphone found.\";\r\n              break;\r\n            case \"NotReadableError\":\r\n              errorMessage = \"Camera or microphone is already in use.\";\r\n              break;\r\n            case \"OverconstrainedError\":\r\n              errorMessage =\r\n                \"Camera or microphone constraints cannot be satisfied.\";\r\n              break;\r\n            case \"SecurityError\":\r\n              errorMessage = \"Security error. Make sure you're using HTTPS.\";\r\n              break;\r\n            case \"AbortError\":\r\n              errorMessage = \"Media access was aborted.\";\r\n              break;\r\n            default:\r\n              errorMessage = err.message || errorMessage;\r\n          }\r\n        }\r\n\r\n        setError(errorMessage);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    },\r\n    [isSupported, initialConstraints, stopCapture],\r\n  );\r\n\r\n  \r\n  useEffect(() => {\r\n    return () => {\r\n      stopCapture();\r\n    };\r\n  }, [stopCapture]);\r\n\r\n  return {\r\n    stream,\r\n    error,\r\n    isLoading,\r\n    isSupported,\r\n    startCapture,\r\n    stopCapture,\r\n  };\r\n};",
    "js": "import { useCallback, useEffect, useRef, useState } from \"react\";\nconst DEFAULT_CONSTRAINTS = {\n    video: true,\n    audio: true,\n};\nexport const useUserMedia = (initialConstraints = DEFAULT_CONSTRAINTS) => {\n    const [stream, setStream] = useState(null);\n    const [error, setError] = useState(null);\n    const [isLoading, setIsLoading] = useState(false);\n    const streamRef = useRef(null);\n    const isSupported = typeof navigator !== \"undefined\" &&\n        \"mediaDevices\" in navigator &&\n        \"getUserMedia\" in navigator.mediaDevices;\n    const stopCapture = useCallback(() => {\n        if (streamRef.current) {\n            streamRef.current.getTracks().forEach((track) => {\n                track.stop();\n            });\n            streamRef.current = null;\n            setStream(null);\n        }\n        setError(null);\n    }, []);\n    const startCapture = useCallback(async (constraints = initialConstraints) => {\n        if (!isSupported) {\n            setError(\"getUserMedia is not supported in this browser\");\n            return;\n        }\n        stopCapture();\n        setIsLoading(true);\n        setError(null);\n        try {\n            const mediaStream = await navigator.mediaDevices.getUserMedia(constraints);\n            streamRef.current = mediaStream;\n            setStream(mediaStream);\n        }\n        catch (err) {\n            let errorMessage = \"Failed to access media devices\";\n            if (err instanceof Error) {\n                switch (err.name) {\n                    case \"NotAllowedError\":\n                        errorMessage =\n                            \"Permission denied. Please allow camera/microphone access.\";\n                        break;\n                    case \"NotFoundError\":\n                        errorMessage = \"No camera or microphone found.\";\n                        break;\n                    case \"NotReadableError\":\n                        errorMessage = \"Camera or microphone is already in use.\";\n                        break;\n                    case \"OverconstrainedError\":\n                        errorMessage =\n                            \"Camera or microphone constraints cannot be satisfied.\";\n                        break;\n                    case \"SecurityError\":\n                        errorMessage = \"Security error. Make sure you're using HTTPS.\";\n                        break;\n                    case \"AbortError\":\n                        errorMessage = \"Media access was aborted.\";\n                        break;\n                    default:\n                        errorMessage = err.message || errorMessage;\n                }\n            }\n            setError(errorMessage);\n        }\n        finally {\n            setIsLoading(false);\n        }\n    }, [isSupported, initialConstraints, stopCapture]);\n    useEffect(() => {\n        return () => {\n            stopCapture();\n        };\n    }, [stopCapture]);\n    return {\n        stream,\n        error,\n        isLoading,\n        isSupported,\n        startCapture,\n        stopCapture,\n    };\n};"
  }
}