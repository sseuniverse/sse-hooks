{
  "$schema": "https://sse-hooks.vercel.app/api/registry/schema/hook.json",
  "name": "use-user-media",
  "type": "registry:hook",
  "title": "useUserMedia",
  "description": "Constraints for the `useUserMedia` hook. Defines the video and audio settings for the media stream.",
  "dependencies": [
    "react"
  ],
  "registryDependencies": [],
  "file": {
    "content": "export interface UseUserMediaConstraints {\n  video?: boolean | MediaTrackConstraints;\n\n  audio?: boolean | MediaTrackConstraints;\n}\n\nexport interface UseUserMediaReturn {\n  stream: MediaStream | null;\n\n  error: string | null;\n\n  isLoading: boolean;\n\n  isSupported: boolean;\n\n  startCapture: (constraints?: UseUserMediaConstraints) => Promise<void>;\n\n  stopCapture: () => void;\n}\n\nimport { useCallback, useEffect, useRef, useState } from \"react\";\n\nconst DEFAULT_CONSTRAINTS: UseUserMediaConstraints = {\n  video: true,\n  audio: true,\n};\n\nexport const useUserMedia = (\n  initialConstraints: UseUserMediaConstraints = DEFAULT_CONSTRAINTS,\n): UseUserMediaReturn => {\n  const [stream, setStream] = useState<MediaStream | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const streamRef = useRef<MediaStream | null>(null);\n\n  const isSupported =\n    typeof navigator !== \"undefined\" &&\n    \"mediaDevices\" in navigator &&\n    \"getUserMedia\" in navigator.mediaDevices;\n\n  const stopCapture = useCallback(() => {\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach((track) => {\n        track.stop();\n      });\n      streamRef.current = null;\n      setStream(null);\n    }\n    setError(null);\n  }, []);\n\n  const startCapture = useCallback(\n    async (constraints: UseUserMediaConstraints = initialConstraints) => {\n      if (!isSupported) {\n        setError(\"getUserMedia is not supported in this browser\");\n        return;\n      }\n\n      stopCapture();\n\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const mediaStream =\n          await navigator.mediaDevices.getUserMedia(constraints);\n        streamRef.current = mediaStream;\n        setStream(mediaStream);\n      } catch (err: any) {\n        let errorMessage = \"Failed to access media devices\";\n\n        if (err instanceof Error) {\n          switch (err.name) {\n            case \"NotAllowedError\":\n              errorMessage =\n                \"Permission denied. Please allow camera/microphone access.\";\n              break;\n            case \"NotFoundError\":\n              errorMessage = \"No camera or microphone found.\";\n              break;\n            case \"NotReadableError\":\n              errorMessage = \"Camera or microphone is already in use.\";\n              break;\n            case \"OverconstrainedError\":\n              errorMessage =\n                \"Camera or microphone constraints cannot be satisfied.\";\n              break;\n            case \"SecurityError\":\n              errorMessage = \"Security error. Make sure you're using HTTPS.\";\n              break;\n            case \"AbortError\":\n              errorMessage = \"Media access was aborted.\";\n              break;\n            default:\n              errorMessage = err.message || errorMessage;\n          }\n        }\n\n        setError(errorMessage);\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [isSupported, initialConstraints, stopCapture],\n  );\n\n  useEffect(() => {\n    return () => {\n      stopCapture();\n    };\n  }, [stopCapture]);\n\n  return {\n    stream,\n    error,\n    isLoading,\n    isSupported,\n    startCapture,\n    stopCapture,\n  };\n};\n",
    "js": "import { useCallback, useEffect, useRef, useState } from \"react\";\nconst DEFAULT_CONSTRAINTS = {\n    video: true,\n    audio: true,\n};\nexport const useUserMedia = (initialConstraints = DEFAULT_CONSTRAINTS) => {\n    const [stream, setStream] = useState(null);\n    const [error, setError] = useState(null);\n    const [isLoading, setIsLoading] = useState(false);\n    const streamRef = useRef(null);\n    const isSupported = typeof navigator !== \"undefined\" &&\n        \"mediaDevices\" in navigator &&\n        \"getUserMedia\" in navigator.mediaDevices;\n    const stopCapture = useCallback(() => {\n        if (streamRef.current) {\n            streamRef.current.getTracks().forEach((track) => {\n                track.stop();\n            });\n            streamRef.current = null;\n            setStream(null);\n        }\n        setError(null);\n    }, []);\n    const startCapture = useCallback(async (constraints = initialConstraints) => {\n        if (!isSupported) {\n            setError(\"getUserMedia is not supported in this browser\");\n            return;\n        }\n        stopCapture();\n        setIsLoading(true);\n        setError(null);\n        try {\n            const mediaStream = await navigator.mediaDevices.getUserMedia(constraints);\n            streamRef.current = mediaStream;\n            setStream(mediaStream);\n        }\n        catch (err) {\n            let errorMessage = \"Failed to access media devices\";\n            if (err instanceof Error) {\n                switch (err.name) {\n                    case \"NotAllowedError\":\n                        errorMessage =\n                            \"Permission denied. Please allow camera/microphone access.\";\n                        break;\n                    case \"NotFoundError\":\n                        errorMessage = \"No camera or microphone found.\";\n                        break;\n                    case \"NotReadableError\":\n                        errorMessage = \"Camera or microphone is already in use.\";\n                        break;\n                    case \"OverconstrainedError\":\n                        errorMessage =\n                            \"Camera or microphone constraints cannot be satisfied.\";\n                        break;\n                    case \"SecurityError\":\n                        errorMessage = \"Security error. Make sure you're using HTTPS.\";\n                        break;\n                    case \"AbortError\":\n                        errorMessage = \"Media access was aborted.\";\n                        break;\n                    default:\n                        errorMessage = err.message || errorMessage;\n                }\n            }\n            setError(errorMessage);\n        }\n        finally {\n            setIsLoading(false);\n        }\n    }, [isSupported, initialConstraints, stopCapture]);\n    useEffect(() => {\n        return () => {\n            stopCapture();\n        };\n    }, [stopCapture]);\n    return {\n        stream,\n        error,\n        isLoading,\n        isSupported,\n        startCapture,\n        stopCapture,\n    };\n};"
  }
}