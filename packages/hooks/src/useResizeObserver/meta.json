{
  "$schema": "https://raw.githubusercontent.com/sseuniverse/sse-hooks/refs/heads/main/schema/meta.json",
  "name": "use-resize-observer",
  "type": "registry:hook",
  "title": "useResizeObserver",
  "description": "The size of the observed element.",
  "dependencies": [
    "react"
  ],
  "registryDependencies": [
    "use-is-mounted"
  ],
  "file": {
    "content": "import { useEffect, useRef, useState } from \"react\";\r\n\r\nimport type { RefObject } from \"react\";\r\n\r\n\n\r\ntype Size = {\r\n  \r\n  width: number | undefined;\r\n  \r\n  height: number | undefined;\r\n};\r\n\r\n\r\ntype UseResizeObserverOptions<T extends HTMLElement = HTMLElement> = {\r\n  \r\n  ref: RefObject<T>;\r\n  \r\n  onResize?: (size: Size) => void;\r\n  \r\n  box?: \"border-box\" | \"content-box\" | \"device-pixel-content-box\";\r\n};\r\n\r\nconst initialSize: Size = {\r\n  width: undefined,\r\n  height: undefined,\r\n};\r\n\r\n\r\nexport function useResizeObserver<T extends HTMLElement = HTMLElement>(\r\n  options: UseResizeObserverOptions<T>,\r\n): Size {\r\n  const { ref, box = \"content-box\" } = options;\r\n  const [{ width, height }, setSize] = useState<Size>(initialSize);\r\n  const isMounted = useIsMounted();\r\n  const previousSize = useRef<Size>({ ...initialSize });\r\n  const onResize = useRef<((size: Size) => void) | undefined>(undefined);\r\n  onResize.current = options.onResize;\r\n\r\n  useEffect(() => {\r\n    if (!ref.current) return;\r\n\r\n    if (typeof window === \"undefined\" || !(\"ResizeObserver\" in window)) return;\r\n\r\n    const observer = new ResizeObserver(([entry]) => {\r\n      const boxProp =\r\n        box === \"border-box\"\r\n          ? \"borderBoxSize\"\r\n          : box === \"device-pixel-content-box\"\r\n            ? \"devicePixelContentBoxSize\"\r\n            : \"contentBoxSize\";\r\n\r\n      const newWidth = extractSize(entry, boxProp, \"inlineSize\");\r\n      const newHeight = extractSize(entry, boxProp, \"blockSize\");\r\n\r\n      const hasChanged =\r\n        previousSize.current.width !== newWidth ||\r\n        previousSize.current.height !== newHeight;\r\n\r\n      if (hasChanged) {\r\n        const newSize: Size = { width: newWidth, height: newHeight };\r\n        previousSize.current.width = newWidth;\r\n        previousSize.current.height = newHeight;\r\n\r\n        if (onResize.current) {\r\n          onResize.current(newSize);\r\n        } else {\r\n          if (isMounted()) {\r\n            setSize(newSize);\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    observer.observe(ref.current, { box });\r\n\r\n    return () => {\r\n      observer.disconnect();\r\n    };\r\n  }, [box, ref, isMounted]);\r\n\r\n  return { width, height };\r\n}\r\n\r\n\r\ntype BoxSizesKey = keyof Pick<\r\n  ResizeObserverEntry,\r\n  \"borderBoxSize\" | \"contentBoxSize\" | \"devicePixelContentBoxSize\"\r\n>;\r\n\r\nfunction extractSize(\r\n  entry: ResizeObserverEntry,\r\n  box: BoxSizesKey,\r\n  sizeType: keyof ResizeObserverSize,\r\n): number | undefined {\r\n  if (!entry[box]) {\r\n    if (box === \"contentBoxSize\") {\r\n      return entry.contentRect[sizeType === \"inlineSize\" ? \"width\" : \"height\"];\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  return Array.isArray(entry[box])\r\n    ? entry[box][0][sizeType]\r\n    : \r\n      (entry[box][sizeType] as number);\r\n}",
    "js": "import { useEffect, useRef, useState } from \"react\";\nconst initialSize = {\n    width: undefined,\n    height: undefined,\n};\nexport function useResizeObserver(options) {\n    const { ref, box = \"content-box\" } = options;\n    const [{ width, height }, setSize] = useState(initialSize);\n    const isMounted = useIsMounted();\n    const previousSize = useRef({ ...initialSize });\n    const onResize = useRef(undefined);\n    onResize.current = options.onResize;\n    useEffect(() => {\n        if (!ref.current)\n            return;\n        if (typeof window === \"undefined\" || !(\"ResizeObserver\" in window))\n            return;\n        const observer = new ResizeObserver(([entry]) => {\n            const boxProp = box === \"border-box\"\n                ? \"borderBoxSize\"\n                : box === \"device-pixel-content-box\"\n                    ? \"devicePixelContentBoxSize\"\n                    : \"contentBoxSize\";\n            const newWidth = extractSize(entry, boxProp, \"inlineSize\");\n            const newHeight = extractSize(entry, boxProp, \"blockSize\");\n            const hasChanged = previousSize.current.width !== newWidth ||\n                previousSize.current.height !== newHeight;\n            if (hasChanged) {\n                const newSize = { width: newWidth, height: newHeight };\n                previousSize.current.width = newWidth;\n                previousSize.current.height = newHeight;\n                if (onResize.current) {\n                    onResize.current(newSize);\n                }\n                else {\n                    if (isMounted()) {\n                        setSize(newSize);\n                    }\n                }\n            }\n        });\n        observer.observe(ref.current, { box });\n        return () => {\n            observer.disconnect();\n        };\n    }, [box, ref, isMounted]);\n    return { width, height };\n}\nfunction extractSize(entry, box, sizeType) {\n    if (!entry[box]) {\n        if (box === \"contentBoxSize\") {\n            return entry.contentRect[sizeType === \"inlineSize\" ? \"width\" : \"height\"];\n        }\n        return undefined;\n    }\n    return Array.isArray(entry[box])\n        ? entry[box][0][sizeType]\n        :\n            entry[box][sizeType];\n}"
  }
}