{
  "$schema": "https://raw.githubusercontent.com/sseuniverse/sse-hooks/refs/heads/main/schema/meta.json",
  "name": "use-battery",
  "type": "registry:hook",
  "title": "useBattery",
  "description": "Represents the state of the battery.",
  "dependencies": [
    "react"
  ],
  "registryDependencies": [],
  "file": {
    "content": "import { useEffect, useState } from \"react\";\nexport function on<T extends Window | Document | HTMLElement | EventTarget>(\n  obj: T | null,\n  ...args: Parameters<T[\"addEventListener\"]> | [string, Function | null, ...any]\n): void {\n  if (obj && obj.addEventListener) {\n    obj.addEventListener(\n      ...(args as Parameters<HTMLElement[\"addEventListener\"]>),\n    );\n  }\n}\n\nexport function off<T extends Window | Document | HTMLElement | EventTarget>(\n  obj: T | null,\n  ...args:\n    | Parameters<T[\"removeEventListener\"]>\n    | [string, Function | null, ...any]\n): void {\n  if (obj && obj.removeEventListener) {\n    obj.removeEventListener(\n      ...(args as Parameters<HTMLElement[\"removeEventListener\"]>),\n    );\n  }\n}\n\nexport const isBrowser = typeof window !== \"undefined\";\nexport const isNavigator = typeof navigator !== \"undefined\";\n\nconst { valueOf, toString } = Object.prototype;\n\nexport const isEqual = (a: any, b: any): boolean => {\n  const visited = new WeakMap();\n\n  const inner = (a: any, b: any): boolean => {\n    if (a === b) {\n      return true;\n    }\n\n    if (typeof a !== \"object\" || typeof b !== \"object\" || !a || !b) {\n      return a !== a && b !== b;\n    }\n\n    if (Object.getPrototypeOf(a) !== Object.getPrototypeOf(b)) {\n      return false;\n    }\n\n    const { constructor } = a;\n\n    if (constructor === Date) {\n      return a.getTime() === b.getTime();\n    }\n\n    if (constructor === RegExp) {\n      return a.source === b.source && a.flags === b.flags;\n    }\n\n    if (constructor === Set) {\n      if (a.size !== b.size) {\n        return false;\n      }\n\n      for (const value of a) {\n        if (!b.has(value)) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n\n    if (constructor === ArrayBuffer) {\n      a = new DataView(a);\n      b = new DataView(b);\n    }\n\n    if (constructor === DataView || ArrayBuffer.isView(a)) {\n      if (constructor !== DataView) {\n        a = new DataView(a.buffer);\n        b = new DataView(b.buffer);\n      }\n\n      if (a.byteLength !== b.byteLength) return false;\n      for (let i = a.byteLength; i-- !== 0; ) {\n        if (a.getUint8(i) !== b.getUint8(i)) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n\n    if (visited.has(a) && visited.get(a) === b) {\n      return true;\n    }\n\n    visited.set(a, b);\n\n    if (constructor === Array) {\n      if (a.length !== b.length) {\n        return false;\n      }\n\n      for (let i = a.length; i-- !== 0; ) {\n        if (!inner(a[i], b[i])) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n\n    if (constructor === Map) {\n      if (a.size !== b.size) {\n        return false;\n      }\n\n      for (const entry of a) {\n        if (!b.has(entry[0]) || !inner(entry[1], b.get(entry[0]))) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n\n    if (\n      a.valueOf !== valueOf &&\n      typeof a.valueOf === \"function\" &&\n      typeof b.valueOf === \"function\"\n    ) {\n      return a.valueOf() === b.valueOf();\n    }\n\n    if (\n      a.toString !== toString &&\n      typeof a.toString === \"function\" &&\n      typeof b.toString === \"function\"\n    ) {\n      return a.toString() === b.toString();\n    }\n\n    const aKeys = Object.keys(a);\n    let key;\n    for (let l = aKeys.length; l-- !== 0; ) {\n      key = aKeys[l];\n      if (!Object.hasOwn(b, key) || !inner(a[key], b[key])) {\n        return false;\n      }\n    }\n\n    return Object.keys(b).length === aKeys.length;\n  };\n\n  return inner(a, b);\n};\n\nexport interface BatteryState {\n  charging: boolean;\n\n  chargingTime: number;\n\n  dischargingTime: number;\n\n  level: number;\n}\n\ninterface BatteryManager extends Readonly<BatteryState>, EventTarget {\n  onchargingchange: () => void;\n  onchargingtimechange: () => void;\n  ondischargingtimechange: () => void;\n  onlevelchange: () => void;\n}\n\ninterface NavigatorWithPossibleBattery extends Navigator {\n  getBattery?: () => Promise<BatteryManager>;\n}\n\ntype UseBatteryState =\n  | { isSupported: false }\n  | { isSupported: true; fetched: false }\n  | (BatteryState & { isSupported: true; fetched: true });\n\nconst nav: NavigatorWithPossibleBattery | undefined = isNavigator\n  ? navigator\n  : undefined;\n\nconst isBatteryApiSupported = nav && typeof nav.getBattery === \"function\";\n\nfunction useBatteryMock(): UseBatteryState {\n  return { isSupported: false };\n}\n\nfunction useBattery(): UseBatteryState {\n  const [state, setState] = useState<UseBatteryState>({\n    isSupported: true,\n    fetched: false,\n  });\n\n  useEffect(() => {\n    let isMounted = true;\n    let battery: BatteryManager | null = null;\n\n    const handleChange = () => {\n      if (!isMounted || !battery) {\n        return;\n      }\n      const newState: UseBatteryState = {\n        isSupported: true,\n        fetched: true,\n        level: battery.level,\n        charging: battery.charging,\n        dischargingTime: battery.dischargingTime,\n        chargingTime: battery.chargingTime,\n      };\n      !isEqual(state, newState) && setState(newState);\n    };\n\n    nav!.getBattery!().then((bat: BatteryManager) => {\n      if (!isMounted) {\n        return;\n      }\n      battery = bat;\n      on(battery, \"chargingchange\", handleChange);\n      on(battery, \"chargingtimechange\", handleChange);\n      on(battery, \"dischargingtimechange\", handleChange);\n      on(battery, \"levelchange\", handleChange);\n      handleChange();\n    });\n\n    return () => {\n      isMounted = false;\n      if (battery) {\n        off(battery, \"chargingchange\", handleChange);\n        off(battery, \"chargingtimechange\", handleChange);\n        off(battery, \"dischargingtimechange\", handleChange);\n        off(battery, \"levelchange\", handleChange);\n      }\n    };\n  }, []);\n\n  return state;\n}\n\nconst useBatteryHook = isBatteryApiSupported ? useBattery : useBatteryMock;\n\nexport { useBatteryHook as useBattery };\n",
    "js": "import { useEffect, useState } from \"react\";\nexport function on(obj, ...args) {\n    if (obj && obj.addEventListener) {\n        obj.addEventListener(...args);\n    }\n}\nexport function off(obj, ...args) {\n    if (obj && obj.removeEventListener) {\n        obj.removeEventListener(...args);\n    }\n}\nexport const isBrowser = typeof window !== \"undefined\";\nexport const isNavigator = typeof navigator !== \"undefined\";\nconst { valueOf, toString } = Object.prototype;\nexport const isEqual = (a, b) => {\n    const visited = new WeakMap();\n    const inner = (a, b) => {\n        if (a === b) {\n            return true;\n        }\n        if (typeof a !== \"object\" || typeof b !== \"object\" || !a || !b) {\n            return a !== a && b !== b;\n        }\n        if (Object.getPrototypeOf(a) !== Object.getPrototypeOf(b)) {\n            return false;\n        }\n        const { constructor } = a;\n        if (constructor === Date) {\n            return a.getTime() === b.getTime();\n        }\n        if (constructor === RegExp) {\n            return a.source === b.source && a.flags === b.flags;\n        }\n        if (constructor === Set) {\n            if (a.size !== b.size) {\n                return false;\n            }\n            for (const value of a) {\n                if (!b.has(value)) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        if (constructor === ArrayBuffer) {\n            a = new DataView(a);\n            b = new DataView(b);\n        }\n        if (constructor === DataView || ArrayBuffer.isView(a)) {\n            if (constructor !== DataView) {\n                a = new DataView(a.buffer);\n                b = new DataView(b.buffer);\n            }\n            if (a.byteLength !== b.byteLength)\n                return false;\n            for (let i = a.byteLength; i-- !== 0;) {\n                if (a.getUint8(i) !== b.getUint8(i)) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        if (visited.has(a) && visited.get(a) === b) {\n            return true;\n        }\n        visited.set(a, b);\n        if (constructor === Array) {\n            if (a.length !== b.length) {\n                return false;\n            }\n            for (let i = a.length; i-- !== 0;) {\n                if (!inner(a[i], b[i])) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        if (constructor === Map) {\n            if (a.size !== b.size) {\n                return false;\n            }\n            for (const entry of a) {\n                if (!b.has(entry[0]) || !inner(entry[1], b.get(entry[0]))) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        if (a.valueOf !== valueOf &&\n            typeof a.valueOf === \"function\" &&\n            typeof b.valueOf === \"function\") {\n            return a.valueOf() === b.valueOf();\n        }\n        if (a.toString !== toString &&\n            typeof a.toString === \"function\" &&\n            typeof b.toString === \"function\") {\n            return a.toString() === b.toString();\n        }\n        const aKeys = Object.keys(a);\n        let key;\n        for (let l = aKeys.length; l-- !== 0;) {\n            key = aKeys[l];\n            if (!Object.hasOwn(b, key) || !inner(a[key], b[key])) {\n                return false;\n            }\n        }\n        return Object.keys(b).length === aKeys.length;\n    };\n    return inner(a, b);\n};\nconst nav = isNavigator\n    ? navigator\n    : undefined;\nconst isBatteryApiSupported = nav && typeof nav.getBattery === \"function\";\nfunction useBatteryMock() {\n    return { isSupported: false };\n}\nfunction useBattery() {\n    const [state, setState] = useState({\n        isSupported: true,\n        fetched: false,\n    });\n    useEffect(() => {\n        let isMounted = true;\n        let battery = null;\n        const handleChange = () => {\n            if (!isMounted || !battery) {\n                return;\n            }\n            const newState = {\n                isSupported: true,\n                fetched: true,\n                level: battery.level,\n                charging: battery.charging,\n                dischargingTime: battery.dischargingTime,\n                chargingTime: battery.chargingTime,\n            };\n            !isEqual(state, newState) && setState(newState);\n        };\n        nav.getBattery().then((bat) => {\n            if (!isMounted) {\n                return;\n            }\n            battery = bat;\n            on(battery, \"chargingchange\", handleChange);\n            on(battery, \"chargingtimechange\", handleChange);\n            on(battery, \"dischargingtimechange\", handleChange);\n            on(battery, \"levelchange\", handleChange);\n            handleChange();\n        });\n        return () => {\n            isMounted = false;\n            if (battery) {\n                off(battery, \"chargingchange\", handleChange);\n                off(battery, \"chargingtimechange\", handleChange);\n                off(battery, \"dischargingtimechange\", handleChange);\n                off(battery, \"levelchange\", handleChange);\n            }\n        };\n    }, []);\n    return state;\n}\nconst useBatteryHook = isBatteryApiSupported ? useBattery : useBatteryMock;\nexport { useBatteryHook as useBattery };"
  }
}