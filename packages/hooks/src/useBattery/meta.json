{
  "$schema": "https://raw.githubusercontent.com/sseuniverse/sse-hooks/refs/heads/main/schema/meta.json",
  "name": "use-battery",
  "type": "registry:hook",
  "title": "useBattery",
  "description": "Represents the state of the battery.",
  "dependencies": [
    "react"
  ],
  "registryDependencies": [],
  "file": {
    "content": "import { useEffect, useState } from \"react\";\r\nexport function on<T extends Window | Document | HTMLElement | EventTarget>(\r\n  obj: T | null,\r\n  ...args: Parameters<T[\"addEventListener\"]> | [string, Function | null, ...any]\r\n): void {\r\n  if (obj && obj.addEventListener) {\r\n    obj.addEventListener(\r\n      ...(args as Parameters<HTMLElement[\"addEventListener\"]>),\r\n    );\r\n  }\r\n}\r\n\r\nexport function off<T extends Window | Document | HTMLElement | EventTarget>(\r\n  obj: T | null,\r\n  ...args:\r\n    | Parameters<T[\"removeEventListener\"]>\r\n    | [string, Function | null, ...any]\r\n): void {\r\n  if (obj && obj.removeEventListener) {\r\n    obj.removeEventListener(\r\n      ...(args as Parameters<HTMLElement[\"removeEventListener\"]>),\r\n    );\r\n  }\r\n}\r\n\r\nexport const isBrowser = typeof window !== \"undefined\";\r\nexport const isNavigator = typeof navigator !== \"undefined\";\r\n\nconst { valueOf, toString } = Object.prototype;\r\n\r\nexport const isEqual = (a: any, b: any): boolean => {\r\n  \r\n  \r\n  const visited = new WeakMap();\r\n\r\n  \r\n  const inner = (a: any, b: any): boolean => {\r\n    \r\n    if (a === b) {\r\n      return true;\r\n    }\r\n\r\n    \r\n    if (typeof a !== \"object\" || typeof b !== \"object\" || !a || !b) {\r\n      \r\n      \r\n      \r\n      return a !== a && b !== b;\r\n    }\r\n\r\n    \r\n    if (Object.getPrototypeOf(a) !== Object.getPrototypeOf(b)) {\r\n      return false;\r\n    }\r\n\r\n    const { constructor } = a;\r\n\r\n    if (constructor === Date) {\r\n      return a.getTime() === b.getTime();\r\n    }\r\n\r\n    if (constructor === RegExp) {\r\n      return a.source === b.source && a.flags === b.flags;\r\n    }\r\n\r\n    if (constructor === Set) {\r\n      if (a.size !== b.size) {\r\n        return false;\r\n      }\r\n\r\n      for (const value of a) {\r\n        if (!b.has(value)) {\r\n          return false;\r\n        }\r\n      }\r\n\r\n      return true;\r\n    }\r\n\r\n    if (constructor === ArrayBuffer) {\r\n      a = new DataView(a);\r\n      b = new DataView(b);\r\n    }\r\n\r\n    if (constructor === DataView || ArrayBuffer.isView(a)) {\r\n      \r\n      if (constructor !== DataView) {\r\n        a = new DataView(a.buffer);\r\n        b = new DataView(b.buffer);\r\n      }\r\n\r\n      if (a.byteLength !== b.byteLength) return false;\r\n      for (let i = a.byteLength; i-- !== 0; ) {\r\n        if (a.getUint8(i) !== b.getUint8(i)) {\r\n          return false;\r\n        }\r\n      }\r\n\r\n      return true;\r\n    }\r\n\r\n    \r\n    if (visited.has(a) && visited.get(a) === b) {\r\n      return true;\r\n    }\r\n\r\n    visited.set(a, b);\r\n\r\n    if (constructor === Array) {\r\n      if (a.length !== b.length) {\r\n        return false;\r\n      }\r\n\r\n      for (let i = a.length; i-- !== 0; ) {\r\n        if (!inner(a[i], b[i])) {\r\n          return false;\r\n        }\r\n      }\r\n\r\n      return true;\r\n    }\r\n\r\n    if (constructor === Map) {\r\n      if (a.size !== b.size) {\r\n        return false;\r\n      }\r\n\r\n      for (const entry of a) {\r\n        if (!b.has(entry[0]) || !inner(entry[1], b.get(entry[0]))) {\r\n          return false;\r\n        }\r\n      }\r\n\r\n      return true;\r\n    }\r\n\r\n    \r\n\r\n    if (\r\n      a.valueOf !== valueOf &&\r\n      typeof a.valueOf === \"function\" &&\r\n      typeof b.valueOf === \"function\"\r\n    ) {\r\n      return a.valueOf() === b.valueOf();\r\n    }\r\n\r\n    if (\r\n      a.toString !== toString &&\r\n      typeof a.toString === \"function\" &&\r\n      typeof b.toString === \"function\"\r\n    ) {\r\n      return a.toString() === b.toString();\r\n    }\r\n\r\n    const aKeys = Object.keys(a);\r\n    let key;\r\n    for (let l = aKeys.length; l-- !== 0; ) {\r\n      key = aKeys[l];\r\n      if (!Object.hasOwn(b, key) || !inner(a[key], b[key])) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return Object.keys(b).length === aKeys.length;\r\n  };\r\n\r\n  return inner(a, b);\r\n};\r\n\n\r\nexport interface BatteryState {\r\n  \r\n  charging: boolean;\r\n  \r\n  chargingTime: number;\r\n  \r\n  dischargingTime: number;\r\n  \r\n  level: number;\r\n}\r\n\r\ninterface BatteryManager extends Readonly<BatteryState>, EventTarget {\r\n  onchargingchange: () => void;\r\n  onchargingtimechange: () => void;\r\n  ondischargingtimechange: () => void;\r\n  onlevelchange: () => void;\r\n}\r\n\r\ninterface NavigatorWithPossibleBattery extends Navigator {\r\n  getBattery?: () => Promise<BatteryManager>;\r\n}\r\n\r\n\r\ntype UseBatteryState =\r\n  | { isSupported: false }\r\n  | { isSupported: true; fetched: false }\r\n  | (BatteryState & { isSupported: true; fetched: true });\r\n\r\nconst nav: NavigatorWithPossibleBattery | undefined = isNavigator\r\n  ? navigator\r\n  : undefined;\r\n\r\nconst isBatteryApiSupported = nav && typeof nav.getBattery === \"function\";\r\n\r\nfunction useBatteryMock(): UseBatteryState {\r\n  return { isSupported: false };\r\n}\r\n\r\n\r\nfunction useBattery(): UseBatteryState {\r\n  const [state, setState] = useState<UseBatteryState>({\r\n    isSupported: true,\r\n    fetched: false,\r\n  });\r\n\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n    let battery: BatteryManager | null = null;\r\n\r\n    const handleChange = () => {\r\n      if (!isMounted || !battery) {\r\n        return;\r\n      }\r\n      const newState: UseBatteryState = {\r\n        isSupported: true,\r\n        fetched: true,\r\n        level: battery.level,\r\n        charging: battery.charging,\r\n        dischargingTime: battery.dischargingTime,\r\n        chargingTime: battery.chargingTime,\r\n      };\r\n      !isEqual(state, newState) && setState(newState);\r\n    };\r\n\r\n    nav!.getBattery!().then((bat: BatteryManager) => {\r\n      if (!isMounted) {\r\n        return;\r\n      }\r\n      battery = bat;\r\n      on(battery, \"chargingchange\", handleChange);\r\n      on(battery, \"chargingtimechange\", handleChange);\r\n      on(battery, \"dischargingtimechange\", handleChange);\r\n      on(battery, \"levelchange\", handleChange);\r\n      handleChange();\r\n    });\r\n\r\n    return () => {\r\n      isMounted = false;\r\n      if (battery) {\r\n        off(battery, \"chargingchange\", handleChange);\r\n        off(battery, \"chargingtimechange\", handleChange);\r\n        off(battery, \"dischargingtimechange\", handleChange);\r\n        off(battery, \"levelchange\", handleChange);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  return state;\r\n}\r\n\r\n\r\nconst useBatteryHook = isBatteryApiSupported ? useBattery : useBatteryMock;\r\n\r\nexport { useBatteryHook as useBattery };",
    "js": "import { useEffect, useState } from \"react\";\nexport function on(obj, ...args) {\n    if (obj && obj.addEventListener) {\n        obj.addEventListener(...args);\n    }\n}\nexport function off(obj, ...args) {\n    if (obj && obj.removeEventListener) {\n        obj.removeEventListener(...args);\n    }\n}\nexport const isBrowser = typeof window !== \"undefined\";\nexport const isNavigator = typeof navigator !== \"undefined\";\nconst { valueOf, toString } = Object.prototype;\nexport const isEqual = (a, b) => {\n    const visited = new WeakMap();\n    const inner = (a, b) => {\n        if (a === b) {\n            return true;\n        }\n        if (typeof a !== \"object\" || typeof b !== \"object\" || !a || !b) {\n            return a !== a && b !== b;\n        }\n        if (Object.getPrototypeOf(a) !== Object.getPrototypeOf(b)) {\n            return false;\n        }\n        const { constructor } = a;\n        if (constructor === Date) {\n            return a.getTime() === b.getTime();\n        }\n        if (constructor === RegExp) {\n            return a.source === b.source && a.flags === b.flags;\n        }\n        if (constructor === Set) {\n            if (a.size !== b.size) {\n                return false;\n            }\n            for (const value of a) {\n                if (!b.has(value)) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        if (constructor === ArrayBuffer) {\n            a = new DataView(a);\n            b = new DataView(b);\n        }\n        if (constructor === DataView || ArrayBuffer.isView(a)) {\n            if (constructor !== DataView) {\n                a = new DataView(a.buffer);\n                b = new DataView(b.buffer);\n            }\n            if (a.byteLength !== b.byteLength)\n                return false;\n            for (let i = a.byteLength; i-- !== 0;) {\n                if (a.getUint8(i) !== b.getUint8(i)) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        if (visited.has(a) && visited.get(a) === b) {\n            return true;\n        }\n        visited.set(a, b);\n        if (constructor === Array) {\n            if (a.length !== b.length) {\n                return false;\n            }\n            for (let i = a.length; i-- !== 0;) {\n                if (!inner(a[i], b[i])) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        if (constructor === Map) {\n            if (a.size !== b.size) {\n                return false;\n            }\n            for (const entry of a) {\n                if (!b.has(entry[0]) || !inner(entry[1], b.get(entry[0]))) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        if (a.valueOf !== valueOf &&\n            typeof a.valueOf === \"function\" &&\n            typeof b.valueOf === \"function\") {\n            return a.valueOf() === b.valueOf();\n        }\n        if (a.toString !== toString &&\n            typeof a.toString === \"function\" &&\n            typeof b.toString === \"function\") {\n            return a.toString() === b.toString();\n        }\n        const aKeys = Object.keys(a);\n        let key;\n        for (let l = aKeys.length; l-- !== 0;) {\n            key = aKeys[l];\n            if (!Object.hasOwn(b, key) || !inner(a[key], b[key])) {\n                return false;\n            }\n        }\n        return Object.keys(b).length === aKeys.length;\n    };\n    return inner(a, b);\n};\nconst nav = isNavigator\n    ? navigator\n    : undefined;\nconst isBatteryApiSupported = nav && typeof nav.getBattery === \"function\";\nfunction useBatteryMock() {\n    return { isSupported: false };\n}\nfunction useBattery() {\n    const [state, setState] = useState({\n        isSupported: true,\n        fetched: false,\n    });\n    useEffect(() => {\n        let isMounted = true;\n        let battery = null;\n        const handleChange = () => {\n            if (!isMounted || !battery) {\n                return;\n            }\n            const newState = {\n                isSupported: true,\n                fetched: true,\n                level: battery.level,\n                charging: battery.charging,\n                dischargingTime: battery.dischargingTime,\n                chargingTime: battery.chargingTime,\n            };\n            !isEqual(state, newState) && setState(newState);\n        };\n        nav.getBattery().then((bat) => {\n            if (!isMounted) {\n                return;\n            }\n            battery = bat;\n            on(battery, \"chargingchange\", handleChange);\n            on(battery, \"chargingtimechange\", handleChange);\n            on(battery, \"dischargingtimechange\", handleChange);\n            on(battery, \"levelchange\", handleChange);\n            handleChange();\n        });\n        return () => {\n            isMounted = false;\n            if (battery) {\n                off(battery, \"chargingchange\", handleChange);\n                off(battery, \"chargingtimechange\", handleChange);\n                off(battery, \"dischargingtimechange\", handleChange);\n                off(battery, \"levelchange\", handleChange);\n            }\n        };\n    }, []);\n    return state;\n}\nconst useBatteryHook = isBatteryApiSupported ? useBattery : useBatteryMock;\nexport { useBatteryHook as useBattery };"
  }
}